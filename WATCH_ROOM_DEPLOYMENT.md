# è§‚å½±å®¤åŠŸèƒ½éƒ¨ç½²æŒ‡å—

è§‚å½±å®¤åŠŸèƒ½å…è®¸å¤šä¸ªç”¨æˆ·åŒæ­¥è§‚çœ‹è§†é¢‘ã€å®æ—¶èŠå¤©å’Œè¯­éŸ³é€šè¯ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©ä½ éƒ¨ç½²å¤–éƒ¨è§‚å½±å®¤æœåŠ¡å™¨ã€‚

## åŠŸèƒ½ç‰¹æ€§

âœ… **å¤šäººåŒæ­¥è§‚å½±**
- æ’­æ”¾/æš‚åœ/è·³è½¬å®æ—¶åŒæ­¥
- æˆ¿ä¸»æ§åˆ¶æ’­æ”¾è¿›åº¦ï¼Œæˆå‘˜è‡ªåŠ¨è·Ÿéš
- åˆ‡æ¢è§†é¢‘/å‰§é›†æ—¶è‡ªåŠ¨æç¤ºæˆå‘˜

âœ… **å®æ—¶èŠå¤©ç³»ç»Ÿ**
- æ–‡å­—æ¶ˆæ¯å³æ—¶å‘é€
- è¡¨æƒ…ç¬¦å·æ”¯æŒ
- æœªè¯»æ¶ˆæ¯æç¤º

âœ… **WebRTC è¯­éŸ³é€šè¯**
- P2P ç‚¹å¯¹ç‚¹è¯­éŸ³è¿æ¥
- å›å£°æ¶ˆé™¤å’Œå™ªéŸ³æŠ‘åˆ¶
- ç‹¬ç«‹çš„éº¦å…‹é£/æ‰¬å£°å™¨æ§åˆ¶

âœ… **æˆ¿é—´ç®¡ç†**
- å…¬å¼€/ç§å¯†æˆ¿é—´
- å¯†ç ä¿æŠ¤
- æˆ¿ä¸»/æˆå‘˜æƒé™ç®¡ç†
- æˆ¿é—´åˆ—è¡¨å®æ—¶æ›´æ–°

âœ… **è¿æ¥çŠ¶æ€ç›‘æ§**
- å®æ—¶è¿æ¥çŠ¶æ€æ˜¾ç¤º
- æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯
- å¿ƒè·³æ£€æµ‹æœºåˆ¶

---

## æ–°å¢åŠŸèƒ½ç‰¹æ€§

æœ¬èŠ‚è®°å½•äº†æœ€è¿‘æ–°å¢å’Œä¼˜åŒ–çš„è§‚å½±å®¤åŠŸèƒ½ã€‚

### ğŸ¯ æ™ºèƒ½æ’­æ”¾åŒæ­¥

**åŒå‰§é›†åˆ‡æ¢ä¼˜åŒ–**
- æˆ¿ä¸»åˆ‡æ¢åŒä¸€éƒ¨å‰§çš„ä¸åŒé›†æ•°æ—¶ï¼Œæˆå‘˜æ— éœ€åˆ·æ–°é¡µé¢å³å¯è‡ªåŠ¨è·Ÿéš
- ä½¿ç”¨ `setCurrentEpisodeIndex` ç›´æ¥åˆ‡æ¢é›†æ•°ï¼Œä¿æŒ WebSocket è¿æ¥
- è‡ªåŠ¨è·³è½¬åˆ°æˆ¿ä¸»çš„æ’­æ”¾æ—¶é—´ç‚¹ï¼ˆ1ç§’å»¶è¿Ÿç¡®ä¿é›†æ•°åŠ è½½å®Œæˆï¼‰
- ä¿æŒæˆ¿é—´çŠ¶æ€ï¼Œé¿å…é‡å¤åŠ å…¥æˆ¿é—´

**è·¨å‰§é›†æ™ºèƒ½è·³è½¬**
- æˆ¿ä¸»åˆ‡æ¢åˆ°ä¸åŒå½±ç‰‡æ—¶ï¼Œä½¿ç”¨å®¢æˆ·ç«¯è·¯ç”±ï¼ˆ`router.push`ï¼‰
- é¿å… `window.location.href` å¯¼è‡´çš„é¡µé¢åˆ·æ–°å’Œ WebSocket æ–­è¿
- è‡ªåŠ¨æºå¸¦æ’­æ”¾æ—¶é—´ã€é›†æ•°ç­‰å‚æ•°ï¼Œå®ç°æ— ç¼åˆ‡æ¢
- æˆå‘˜æ”¶åˆ°å¼¹çª—æç¤ºï¼Œå¯é€‰æ‹©"è·Ÿéšæˆ¿ä¸»"æˆ–"è‡ªç”±è§‚çœ‹"

**æŠ€æœ¯å®ç°**
```typescript
// åŒä¸€éƒ¨å‰§ï¼šç›´æ¥åˆ‡æ¢é›†æ•°
if (isSameShow) {
  setCurrentEpisodeIndex(state.episode);
  setTimeout(() => artPlayer.currentTime = state.currentTime, 1000);
}
// ä¸åŒå‰§ï¼šå®¢æˆ·ç«¯è·¯ç”±è·³è½¬
else {
  router.push(`/play?${params.toString()}`);
}
```

### ğŸ“º æ­£åœ¨è§‚çœ‹æ˜¾ç¤º

**æˆ¿é—´ä¿¡æ¯é¢æ¿å¢å¼º**
- åˆ›å»º/åŠ å…¥æˆ¿é—´åå¯æŸ¥çœ‹å½“å‰æ­£åœ¨è§‚çœ‹çš„å½±ç‰‡
- ä½¿ç”¨è¿·ä½ è§†é¢‘å¡ç‰‡å±•ç¤ºï¼š
  - æµ·æŠ¥ç¼©ç•¥å›¾ï¼ˆ64x96pxï¼‰
  - å½±ç‰‡æ ‡é¢˜
  - å¹´ä»½ä¿¡æ¯
  - é›†æ•°ä¿¡æ¯ï¼ˆTVå‰§ï¼‰
  - æ’­æ”¾å›¾æ ‡è¦†å±‚
- ç‚¹å‡»è§†é¢‘å¡ç‰‡å¯ç›´æ¥è·³è½¬åˆ°æ’­æ”¾é¡µé¢å¹¶åŒæ­¥è¿›åº¦
- è‡ªåŠ¨æºå¸¦æˆ¿ä¸»çš„å½“å‰æ’­æ”¾æ—¶é—´ï¼Œå®ç°æ—¶é—´åŒæ­¥

**æˆ¿é—´åˆ—è¡¨å¢å¼º**
- æˆ¿é—´åˆ—è¡¨ä¸­å±•ç¤ºå„æˆ¿é—´æ­£åœ¨è§‚çœ‹çš„å†…å®¹
- å®Œæ•´çš„å›¾ç‰‡å¤„ç†å’Œå ä½ç¬¦æ”¯æŒ
- å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé»˜è®¤å ä½ç¬¦ï¼ˆSVGï¼‰
- ç‚¹å‡»è§†é¢‘å¡ç‰‡è·³è½¬åˆ°æ’­æ”¾é¡µé¢ï¼ˆä¸æºå¸¦æ—¶é—´å‚æ•°ï¼Œå› ä¸ºç”¨æˆ·å°šæœªåŠ å…¥æˆ¿é—´ï¼‰

**MiniVideoCard ç»„ä»¶**
- ä¸“é—¨ä¸ºè§‚å½±å®¤è®¾è®¡çš„ç´§å‡‘å‹è§†é¢‘å¡ç‰‡
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒæ·±è‰²æ¨¡å¼
- æ‚¬åœæ•ˆæœæå‡ç”¨æˆ·ä½“éªŒ
- ä½¿ç”¨ Next.js Image ç»„ä»¶ä¼˜åŒ–å›¾ç‰‡åŠ è½½
- `referrerPolicy="no-referrer"` è§£å†³è·¨åŸŸå›¾ç‰‡é—®é¢˜

### ğŸ¬ é›†æ•°æ˜¾ç¤ºä¼˜åŒ–

**æ™ºèƒ½åˆ¤æ–­é€»è¾‘**
- æ ¹æ® `totalEpisodes` å­—æ®µè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºé›†æ•°ä¿¡æ¯
- **ç”µå½±**ï¼ˆtotalEpisodes = 1ï¼‰ï¼šä¸æ˜¾ç¤º"ç¬¬1é›†"
- **ç”µè§†å‰§**ï¼ˆtotalEpisodes > 1ï¼‰ï¼šæ˜¾ç¤º"ç¬¬Xé›†"
- é¿å…ç”µå½±æ˜¾ç¤ºä¸å¿…è¦çš„é›†æ•°ä¿¡æ¯ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

**å®ç°ç»†èŠ‚**
- åœ¨æ•´ä¸ªçŠ¶æ€é“¾ä¸­ä¼ é€’ `totalEpisodes` å­—æ®µï¼š
  - `PlayState` æ¥å£
  - `OwnerPlayState` æ¥å£
  - æ‰€æœ‰ Socket.IO äº‹ä»¶å¹¿æ’­
  - `MiniVideoCard` ç»„ä»¶
- ä»å½±ç‰‡è¯¦æƒ…ä¸­è‡ªåŠ¨æå–ï¼š`detail?.episodes?.length`

**æ˜¾ç¤ºé€»è¾‘**
```typescript
{totalEpisodes && totalEpisodes > 1 && episode !== undefined && (
  <span>ç¬¬ {episode + 1} é›†</span>
)}
```

### ğŸ‘¤ ç”¨æˆ·åè¯†åˆ«æ”¹è¿›

**é—®é¢˜èƒŒæ™¯**
- Cookie åœ¨æµè§ˆå™¨ä¸­å¼‚æ­¥åŠ è½½ï¼Œé¦–æ¬¡åŠ è½½æ—¶å¯èƒ½æœªå‡†å¤‡å¥½
- å¯¼è‡´ç”¨æˆ·åŠ å…¥æˆ¿é—´æ—¶æ˜¾ç¤ºä¸º"æ¸¸å®¢"è€ŒéçœŸå®ç”¨æˆ·å
- ç”¨æˆ·éœ€è¦æ‰‹åŠ¨åˆ·æ–°é¡µé¢æ‰èƒ½æ˜¾ç¤ºæ­£ç¡®ç”¨æˆ·å

**è§£å†³æ–¹æ¡ˆï¼šæŒç»­è½®è¯¢æ£€æµ‹**
- ä½¿ç”¨ `setInterval` æŒç»­æ£€æŸ¥ Cookie æ˜¯å¦åŠ è½½å®Œæˆ
- æœ€å¤šæ£€æŸ¥ 20 æ¬¡ï¼Œæ¯æ¬¡é—´éš” 500msï¼ˆæ€»è®¡ 10 ç§’ï¼‰
- æˆåŠŸè·å–ç”¨æˆ·ååç«‹å³åœæ­¢æ£€æŸ¥
- è¾¾åˆ°æœ€å¤§æ¬¡æ•°ååœæ­¢ï¼Œé¿å…æ— é™å¾ªç¯

**å®ç°ä»£ç **
```typescript
const checkUsername = () => {
  const authInfo = getAuthInfoFromBrowserCookie();
  const username = authInfo?.username || 'æ¸¸å®¢';

  if (username !== 'æ¸¸å®¢') {
    setCurrentUserName(username);
    setUserNameLoaded(true);
    if (intervalId) clearInterval(intervalId);
  } else if (checkCount >= maxChecks) {
    setCurrentUserName('æ¸¸å®¢');
    setUserNameLoaded(true);
    if (intervalId) clearInterval(intervalId);
  }
};
```

**ç”¨æˆ·ä½“éªŒæå‡**
- é¦–æ¬¡åŠ è½½å³å¯æ­£ç¡®æ˜¾ç¤ºç”¨æˆ·åï¼ˆæ— éœ€åˆ·æ–°ï¼‰
- æˆå‘˜åˆ—è¡¨ä¸­æ˜¾ç¤ºçœŸå®ç”¨æˆ·å
- èŠå¤©æ¶ˆæ¯æ˜¾ç¤ºæ­£ç¡®çš„å‘é€è€…åç§°

### ğŸ”„ æˆ¿ä¸»æœ¬åœ°çŠ¶æ€åŒæ­¥

**é—®é¢˜èƒŒæ™¯**
- WebSocket æœåŠ¡å™¨ä¸ä¼šå°†äº‹ä»¶å›ä¼ ç»™å‘é€è€…ï¼ˆsenderï¼‰
- æˆ¿ä¸»å‘é€æ’­æ”¾çŠ¶æ€æ›´æ–°åï¼Œè‡ªå·±çš„æˆ¿é—´ä¿¡æ¯é¢æ¿ä¸ä¼šæ›´æ–°
- å¯¼è‡´æˆ¿ä¸»çœ‹ä¸åˆ°è‡ªå·±æ­£åœ¨æ’­æ”¾çš„è§†é¢‘ï¼Œä½†æˆå‘˜å¯ä»¥çœ‹åˆ°

**è§£å†³æ–¹æ¡ˆ**
- æˆ¿ä¸»å‘é€ Socket.IO äº‹ä»¶æ—¶ï¼ŒåŒæ—¶æ›´æ–°æœ¬åœ°çŠ¶æ€
- åœ¨ `updatePlayState`ã€`changeVideo`ã€`clearState` ç­‰æ–¹æ³•ä¸­æ·»åŠ æœ¬åœ°æ›´æ–°

**å®ç°ä»£ç **
```typescript
const updatePlayState = useCallback((state: PlayState) => {
  if (socket && connected) {
    socket.emit('play:update', state);
    // âœ… æœ¬åœ°æ›´æ–°ï¼Œå› ä¸ºæœåŠ¡å™¨ä¸ä¼šå›ä¼ ç»™å‘é€è€…
    setCurrentRoom((prev) => prev ? { ...prev, currentState: state } : null);
  }
}, [socket, connected]);
```

**ä¿æŒä¸€è‡´æ€§**
- æˆ¿ä¸»å’Œæˆå‘˜çœ‹åˆ°ç›¸åŒçš„æˆ¿é—´çŠ¶æ€
- æˆ¿é—´ä¿¡æ¯é¢æ¿å®æ—¶æ˜¾ç¤ºæ­£åœ¨æ’­æ”¾çš„å†…å®¹
- æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½é€šè¿‡æˆ¿é—´ä¿¡æ¯å¿«é€Ÿè·³è½¬åˆ°å½“å‰å½±ç‰‡

### ğŸ› å…³é”® Bug ä¿®å¤

**çŠ¶æ€æ›´æ–°ç¼ºå¤±ï¼ˆCriticalï¼‰**
- **é—®é¢˜**ï¼š`useWatchRoom.ts` ä¸­çš„äº‹ä»¶ç›‘å¬å™¨åªè®°å½•æ—¥å¿—ï¼Œä»æœªæ›´æ–°çŠ¶æ€
- **å½±å“**ï¼šæˆ¿é—´ä¿¡æ¯é¢æ¿ã€æˆ¿é—´åˆ—è¡¨ç­‰æ‰€æœ‰ä¾èµ– `currentRoom.currentState` çš„åŠŸèƒ½å…¨éƒ¨å¤±æ•ˆ
- **ä¿®å¤**ï¼šåœ¨æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ä¸­æ·»åŠ  `setCurrentRoom` è°ƒç”¨
```typescript
socket.on('play:update', (state: PlayState) => {
  console.log('[WatchRoom] Play state updated:', state);
  setCurrentRoom((prev) => prev ? { ...prev, currentState: state } : null);
});
```

**æˆ¿é—´åˆ—è¡¨æ—¶é—´åŒæ­¥é€»è¾‘é”™è¯¯**
- **é—®é¢˜**ï¼šç”¨æˆ·æœªåŠ å…¥æˆ¿é—´æ—¶ï¼Œç‚¹å‡»æˆ¿é—´åˆ—è¡¨çš„è§†é¢‘å¡ç‰‡ä¹Ÿä¼šæºå¸¦æ—¶é—´å‚æ•°åŒæ­¥æ’­æ”¾è¿›åº¦
- **å½±å“**ï¼šé€»è¾‘ä¸åˆç†ï¼Œç”¨æˆ·åº”è¯¥ä»å¤´å¼€å§‹è§‚çœ‹ï¼Œè€Œéè·³è½¬åˆ°æˆ¿ä¸»çš„æ—¶é—´ç‚¹
- **ä¿®å¤**ï¼šæˆ¿é—´åˆ—è¡¨å¯¼èˆªæ—¶ä¸æºå¸¦ `t`ï¼ˆæ—¶é—´ï¼‰å’Œ `prefer` å‚æ•°ï¼Œä»…æˆ¿é—´ä¿¡æ¯é¢æ¿å†…çš„è·³è½¬æ‰æºå¸¦

**ç±»å‹å­—æ®µåç§°é”™è¯¯**
- **é—®é¢˜**ï¼šä½¿ç”¨äº†æ—§çš„å­—æ®µå `vod_name`ã€`vod_year` è€Œé `SearchResult` æ¥å£çš„ `title`ã€`year`
- **å½±å“**ï¼šTypeScript ç¼–è¯‘å¤±è´¥
- **ä¿®å¤**ï¼šç»Ÿä¸€ä½¿ç”¨æ­£ç¡®çš„å­—æ®µåç§°

### ğŸ“ ä»£ç æ”¹è¿›

**æ–°å¢æ–‡ä»¶**
- `src/components/watch-room/MiniVideoCard.tsx` - è¿·ä½ è§†é¢‘å¡ç‰‡ç»„ä»¶

**ä¿®æ”¹æ–‡ä»¶**
- `src/types/watch-room.types.ts` - æ·»åŠ  `totalEpisodes` å­—æ®µ
- `src/hooks/useWatchRoom.ts` - ä¿®å¤äº‹ä»¶ç›‘å¬å™¨çŠ¶æ€æ›´æ–°ï¼Œæ·»åŠ æˆ¿ä¸»æœ¬åœ°æ›´æ–°
- `src/app/play/hooks/useWatchRoomSync.ts` - å®ç°æ™ºèƒ½å¯¼èˆªé€»è¾‘ï¼Œæ·»åŠ  `totalEpisodes` ä¼ é€’
- `src/components/WatchRoomProvider.tsx` - å®ç°ç”¨æˆ·åæŒç»­æ£€æµ‹æœºåˆ¶
- `src/components/watch-room/ChatFloatingWindow.tsx` - ä½¿ç”¨ MiniVideoCardï¼Œæ·»åŠ  `totalEpisodes`
- `src/app/watch-room/page.tsx` - ä½¿ç”¨ MiniVideoCardï¼Œä¿®å¤æˆ¿é—´åˆ—è¡¨é€»è¾‘
- `src/app/play/page.tsx` - ä¿®å¤å­—æ®µåç§°ï¼Œæ·»åŠ  `setCurrentEpisodeIndex` å‚æ•°

**å…³é”®æŠ€æœ¯å†³ç­–**
- ä½¿ç”¨ `router.push` è€Œé `window.location.href` ä¿æŒ WebSocket è¿æ¥
- ä½¿ç”¨ `setInterval` è€Œé `setTimeout` å®ç°æŒç»­æ£€æµ‹
- åœ¨å‘é€ç«¯æ·»åŠ æœ¬åœ°çŠ¶æ€æ›´æ–°ä»¥è§£å†³æœåŠ¡å™¨ä¸å›ä¼ é—®é¢˜
- æ ¹æ® `totalEpisodes` æ¡ä»¶æ¸²æŸ“é›†æ•°ä¿¡æ¯

---

## æ¶æ„è¯´æ˜

è§‚å½±å®¤åŠŸèƒ½ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š

1. **LunaTV å‰ç«¯**ï¼šå·²é›†æˆåˆ°æœ¬é¡¹ç›®ä¸­ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²
2. **è§‚å½±å®¤æœåŠ¡å™¨**ï¼šéœ€è¦å•ç‹¬éƒ¨ç½²çš„ Socket.IO æœåŠ¡å™¨

**ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ï¼Ÿ**

- Vercel ç­‰ Serverless å¹³å°ä¸æ”¯æŒ WebSocket é•¿è¿æ¥
- ç‹¬ç«‹éƒ¨ç½²æ›´çµæ´»ï¼Œå¯é€‰æ‹©æœ€ä½³çš„æœåŠ¡å™¨å¹³å°
- å¯é€‰åŠŸèƒ½ï¼Œä¸å½±å“ä¸»åº”ç”¨éƒ¨ç½²

---

## æœåŠ¡å™¨æºç 

è§‚å½±å®¤æœåŠ¡å™¨å¼€æºé¡¹ç›®ï¼š[watch-room-server](https://github.com/tgs9915/watch-room-server)

**å¤šå¹³å° Docker é•œåƒ**ï¼š`ghcr.io/szemeng76/watch-room-server:latest`
ï¼ˆæ”¯æŒ linux/amd64 å’Œ linux/arm64 æ¶æ„ï¼Œå¯åœ¨ x86 å’Œ ARM è®¾å¤‡ä¸ŠåŸç”Ÿè¿è¡Œï¼‰

---

## éƒ¨ç½²é€‰é¡¹

### é€‰é¡¹ 1ï¼šFly.io å…è´¹éƒ¨ç½²ï¼ˆæ¨èï¼‰

Fly.io æä¾›å…è´¹é¢åº¦ï¼Œé€‚åˆå°è§„æ¨¡ä½¿ç”¨ã€‚

#### å‡†å¤‡å·¥ä½œ

1. æ³¨å†Œ [Fly.io è´¦å·](https://fly.io/app/sign-up)
2. å®‰è£… Fly CLIï¼š
   ```bash
   # macOS/Linux
   curl -L https://fly.io/install.sh | sh

   # Windows (PowerShell)
   iwr https://fly.io/install.ps1 -useb | iex
   ```

3. ç™»å½• Fly.ioï¼š
   ```bash
   flyctl auth login
   ```

#### éƒ¨ç½²æ­¥éª¤

1. å…‹éš†è§‚å½±å®¤æœåŠ¡å™¨ä»£ç ï¼š
   ```bash
   git clone https://github.com/tgs9915/watch-room-server.git
   cd watch-room-server
   ```

2. åˆ›å»º `fly.toml` é…ç½®æ–‡ä»¶ï¼š
   ```toml
   app = "your-watch-room-server"  # ä¿®æ”¹ä¸ºä½ çš„åº”ç”¨åç§°ï¼ˆå…¨å±€å”¯ä¸€ï¼‰

   [build]
   dockerfile = "Dockerfile"

   [env]
   PORT = "8080"
   AUTH_KEY = "your-secure-random-key-here"  # ä¿®æ”¹ä¸ºå¼ºå¯†ç 

   [[services]]
   internal_port = 8080
   protocol = "tcp"

   [[services.ports]]
   handlers = ["http"]
   port = 80

   [[services.ports]]
   handlers = ["tls", "http"]
   port = 443
   ```

3. éƒ¨ç½²åˆ° Fly.ioï¼š
   ```bash
   flyctl launch --no-deploy  # åˆ›å»ºåº”ç”¨
   flyctl deploy              # éƒ¨ç½²åº”ç”¨
   ```

4. è·å–åº”ç”¨ URLï¼š
   ```bash
   flyctl info
   ```

   ä½ çš„æœåŠ¡å™¨åœ°å€å°†ç±»ä¼¼äºï¼š`https://your-watch-room-server.fly.dev`

#### Fly.io ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æ—¥å¿—
flyctl logs

# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
flyctl status

# é‡å¯åº”ç”¨
flyctl restart

# é”€æ¯åº”ç”¨
flyctl destroy your-watch-room-server
```

---

### é€‰é¡¹ 2ï¼šRailway éƒ¨ç½²

Railway æä¾›ç®€å•çš„éƒ¨ç½²ä½“éªŒï¼Œæœ‰ä¸€å®šå…è´¹é¢åº¦ã€‚

#### éƒ¨ç½²æ­¥éª¤

1. è®¿é—® [Railway](https://railway.app/) å¹¶ç™»å½•
2. ç‚¹å‡» "New Project" â†’ "Deploy from GitHub repo"
3. æˆæƒè®¿é—®ä½  fork çš„ `watch-room-server` ä»“åº“
4. é€‰æ‹©ä»“åº“åï¼ŒRailway ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶å¼€å§‹éƒ¨ç½²
5. åœ¨ "Variables" æ ‡ç­¾é¡µæ·»åŠ ç¯å¢ƒå˜é‡ï¼š
   - `AUTH_KEY`: è®¾ç½®ä¸ºå¼ºå¯†ç ï¼ˆå¿…éœ€ï¼‰
   - `PORT`: 8080ï¼ˆå¯é€‰ï¼Œé»˜è®¤ 8080ï¼‰
6. éƒ¨ç½²å®Œæˆåï¼Œåœ¨ "Settings" â†’ "Networking" ä¸­ç”Ÿæˆå…¬å¼€åŸŸå
7. å¤åˆ¶åŸŸååœ°å€ï¼ˆä¾‹å¦‚ï¼š`https://your-app.railway.app`ï¼‰

---

### é€‰é¡¹ 3ï¼šDocker éƒ¨ç½²

é€‚åˆè‡ªæœ‰æœåŠ¡å™¨æˆ– VPSã€‚

#### ä½¿ç”¨é¢„æ„å»ºé•œåƒï¼ˆæ¨èï¼‰

ä½¿ç”¨å¤šå¹³å°é•œåƒï¼Œæ— éœ€ç¼–è¯‘ï¼š

```bash
# æ‹‰å–é•œåƒ
docker pull ghcr.io/szemeng76/watch-room-server:latest

# è¿è¡Œå®¹å™¨
docker run -d \
  --name watch-room-server \
  --restart unless-stopped \
  -p 8080:8080 \
  -e AUTH_KEY=your-secure-random-key-here \
  -e PORT=8080 \
  ghcr.io/szemeng76/watch-room-server:latest

# æŸ¥çœ‹æ—¥å¿—
docker logs -f watch-room-server
```

æˆ–ä½¿ç”¨ Docker Composeï¼Œåˆ›å»º `docker-compose.yml`ï¼š

```yaml
version: '3.8'

services:
  watch-room-server:
    image: ghcr.io/szemeng76/watch-room-server:latest
    container_name: watch-room-server
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - AUTH_KEY=your-secure-random-key-here
      - PORT=8080
```

ç„¶åè¿è¡Œï¼š

```bash
docker-compose up -d
docker-compose logs -f
```

#### ä»æºç æ„å»ºï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦è‡ªå®šä¹‰ä¿®æ”¹ï¼š

1. å…‹éš†æœåŠ¡å™¨ä»£ç ï¼š
   ```bash
   git clone https://github.com/tgs9915/watch-room-server.git
   cd watch-room-server
   ```

2. åˆ›å»º `.env` æ–‡ä»¶ï¼š
   ```env
   AUTH_KEY=your-secure-random-key-here
   PORT=8080
   ```

3. ä½¿ç”¨ Docker Compose éƒ¨ç½²ï¼š
   ```bash
   docker-compose up -d
   ```

4. æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼š
   ```bash
   docker-compose ps
   docker-compose logs -f
   ```

5. é…ç½®åå‘ä»£ç†ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰ï¼š

   **Nginx é…ç½®ç¤ºä¾‹ï¼š**
   ```nginx
   server {
       listen 443 ssl http2;
       server_name watch-room.yourdomain.com;

       ssl_certificate /path/to/cert.pem;
       ssl_certificate_key /path/to/key.pem;

       location / {
           proxy_pass http://localhost:8080;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection "upgrade";
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
   }
   ```

---

### é€‰é¡¹ 4ï¼šç›´æ¥åœ¨ VPS ä¸Šè¿è¡Œ

é€‚åˆæœ‰ Node.js ç¯å¢ƒçš„ VPSã€‚

#### éƒ¨ç½²æ­¥éª¤

1. ç¡®ä¿æœåŠ¡å™¨å·²å®‰è£… Node.js 18+ï¼š
   ```bash
   node --version
   ```

2. å…‹éš†ä»£ç å¹¶å®‰è£…ä¾èµ–ï¼š
   ```bash
   git clone https://github.com/tgs9915/watch-room-server.git
   cd watch-room-server
   npm install
   ```

3. åˆ›å»º `.env` æ–‡ä»¶ï¼š
   ```env
   AUTH_KEY=your-secure-random-key-here
   PORT=8080
   ```

4. æ„å»ºå¹¶è¿è¡Œï¼š
   ```bash
   npm run build
   npm start
   ```

5. ä½¿ç”¨ PM2 å®ˆæŠ¤è¿›ç¨‹ï¼ˆæ¨èï¼‰ï¼š
   ```bash
   # å®‰è£… PM2
   npm install -g pm2

   # å¯åŠ¨æœåŠ¡
   pm2 start npm --name "watch-room-server" -- start

   # è®¾ç½®å¼€æœºè‡ªå¯
   pm2 startup
   pm2 save

   # æŸ¥çœ‹æ—¥å¿—
   pm2 logs watch-room-server

   # é‡å¯æœåŠ¡
   pm2 restart watch-room-server
   ```

---

## LunaTV é…ç½®

éƒ¨ç½²å®Œè§‚å½±å®¤æœåŠ¡å™¨åï¼Œéœ€è¦åœ¨ LunaTV ç®¡ç†åå°é…ç½®ï¼š

1. ç™»å½• LunaTV ç®¡ç†åå°ï¼ˆéœ€è¦ owner æˆ– admin æƒé™ï¼‰
2. è¿›å…¥"è§‚å½±å®¤é…ç½®"æ ‡ç­¾é¡µ
3. å¡«å†™é…ç½®ä¿¡æ¯ï¼š
   - **å¯ç”¨è§‚å½±å®¤åŠŸèƒ½**ï¼šå‹¾é€‰æ­¤é€‰é¡¹
   - **æœåŠ¡å™¨åœ°å€**ï¼šå¡«å†™ä½ éƒ¨ç½²çš„æœåŠ¡å™¨ URLï¼ˆä¾‹å¦‚ï¼š`https://your-watch-room-server.fly.dev`ï¼‰
   - **è®¤è¯å¯†é’¥**ï¼šå¡«å†™ä¸æœåŠ¡å™¨ `AUTH_KEY` ç›¸åŒçš„å¯†é’¥
4. ç‚¹å‡»"æµ‹è¯•è¿æ¥"éªŒè¯é…ç½®
5. ç‚¹å‡»"ä¿å­˜é…ç½®"
6. æŸ¥çœ‹"æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯"ç¡®è®¤è¿æ¥æˆåŠŸ

### é…ç½®è¯´æ˜

- **æœåŠ¡å™¨åœ°å€**ï¼šå¿…é¡»æ˜¯å®Œæ•´çš„ URLï¼ŒåŒ…å«åè®®ï¼ˆhttp:// æˆ– https://ï¼‰
- **è®¤è¯å¯†é’¥**ï¼šç”¨äºéªŒè¯ LunaTV å®¢æˆ·ç«¯èº«ä»½ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®
  - å¿…é¡»ä¸æœåŠ¡å™¨çš„ `AUTH_KEY` ç¯å¢ƒå˜é‡ä¸€è‡´
  - å»ºè®®ä½¿ç”¨ 32 ä½ä»¥ä¸Šçš„éšæœºå­—ç¬¦ä¸²
  - å¯ä½¿ç”¨åœ¨çº¿å·¥å…·ç”Ÿæˆï¼š[Random.org](https://www.random.org/strings/)

### âš ï¸ å¤šç«™ç‚¹å…±äº«è­¦å‘Š

**é‡è¦æç¤º**ï¼šå¦‚æœå¤šä¸ª LunaTV ç«™ç‚¹ä½¿ç”¨åŒä¸€ä¸ªè§‚å½±å®¤æœåŠ¡å™¨ï¼š

- âœ… æ‰€æœ‰ç«™ç‚¹å°†å…±äº«åŒä¸€ä¸ªæˆ¿é—´æ± 
- âœ… ç«™ç‚¹Aåˆ›å»ºçš„æˆ¿é—´ï¼Œç«™ç‚¹Bçš„ç”¨æˆ·ä¹Ÿèƒ½çœ‹åˆ°å’ŒåŠ å…¥
- âš ï¸ å¯èƒ½å¯¼è‡´ç”¨æˆ·å›°æƒ‘å’Œä½“éªŒé—®é¢˜
- ğŸ’¡ **å»ºè®®**ï¼šæ¯ä¸ªç«™ç‚¹ä½¿ç”¨ç‹¬ç«‹çš„è§‚å½±å®¤æœåŠ¡å™¨
- ğŸ’¡ å¦‚éœ€è·¨ç«™ç‚¹è§‚å½±ï¼Œå¯æœ‰æ„å…±ç”¨æœåŠ¡å™¨ï¼Œä½†éœ€åœ¨æˆ¿é—´åç§°ä¸­æ³¨æ˜ç«™ç‚¹

---

## åŠŸèƒ½æµ‹è¯•

é…ç½®å®Œæˆåï¼Œæµ‹è¯•è§‚å½±å®¤å…¨éƒ¨åŠŸèƒ½ï¼š

### 1. æˆ¿é—´ç®¡ç†æµ‹è¯•

1. åœ¨ LunaTV å¯¼èˆªæ æ‰¾åˆ°"è§‚å½±å®¤"å…¥å£
2. æŸ¥çœ‹è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆåº”æ˜¾ç¤º"å·²è¿æ¥"ï¼‰
3. åˆ›å»ºä¸€ä¸ªæµ‹è¯•æˆ¿é—´ï¼š
   - å¡«å†™æˆ¿é—´åç§°
   - å¯é€‰ï¼šè®¾ç½®æˆ¿é—´å¯†ç 
   - é€‰æ‹©å…¬å¼€/ç§å¯†
4. æ£€æŸ¥æˆ¿é—´åˆ›å»ºæˆåŠŸï¼Œæ˜¾ç¤ºæˆ¿é—´å·å’Œæˆå‘˜åˆ—è¡¨
5. ä½¿ç”¨å¦ä¸€ä¸ªæµè§ˆå™¨/è®¾å¤‡åŠ å…¥è¯¥æˆ¿é—´

### 2. èŠå¤©åŠŸèƒ½æµ‹è¯•

1. åœ¨æˆ¿é—´å†…ç‚¹å‡»èŠå¤©æŒ‰é’®ï¼ˆç»¿è‰²æ°”æ³¡å›¾æ ‡ï¼‰
2. å‘é€æ–‡å­—æ¶ˆæ¯ï¼ŒéªŒè¯å®æ—¶ä¼ é€
3. æµ‹è¯•è¡¨æƒ…ç¬¦å·å‘é€
4. å…³é—­èŠå¤©çª—å£ï¼ŒæŸ¥çœ‹æœªè¯»æ¶ˆæ¯æç¤º

### 3. åŒæ­¥æ’­æ”¾æµ‹è¯•

1. ä¸¤ä¸ªç”¨æˆ·éƒ½è¿›å…¥æ’­æ”¾é¡µé¢ï¼ˆæ’­æ”¾ä»»æ„è§†é¢‘ï¼‰
2. **æˆ¿ä¸»æ“ä½œ**ï¼š
   - ç‚¹å‡»æ’­æ”¾ â†’ æˆå‘˜åº”è‡ªåŠ¨æ’­æ”¾
   - ç‚¹å‡»æš‚åœ â†’ æˆå‘˜åº”è‡ªåŠ¨æš‚åœ
   - æ‹–åŠ¨è¿›åº¦æ¡ â†’ æˆå‘˜åº”è·³è½¬åˆ°ç›¸åŒæ—¶é—´
   - åˆ‡æ¢é›†æ•° â†’ æˆå‘˜æ”¶åˆ°å¼¹çª—æç¤º
3. **æˆå‘˜éªŒè¯**ï¼š
   - æ’­æ”¾å™¨è‡ªåŠ¨å“åº”æˆ¿ä¸»æ“ä½œ
   - æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹åŒæ­¥æ—¥å¿—

### 4. è¯­éŸ³é€šè¯æµ‹è¯•

1. åœ¨èŠå¤©çª—å£ä¸­ç‚¹å‡»éº¦å…‹é£æŒ‰é’®
2. æµè§ˆå™¨è¯·æ±‚éº¦å…‹é£æƒé™ï¼Œç‚¹å‡»å…è®¸
3. å¦ä¸€ç”¨æˆ·ä¹Ÿæ‰“å¼€éº¦å…‹é£
4. éªŒè¯åŒæ–¹èƒ½å¬åˆ°å¯¹æ–¹å£°éŸ³
5. æµ‹è¯•æ‰¬å£°å™¨é™éŸ³/å¼€å¯åŠŸèƒ½

### 5. æˆ¿é—´ç®¡ç†æµ‹è¯•

1. ç‚¹å‡»æˆ¿é—´ä¿¡æ¯æŒ‰é’®ï¼ˆè“è‰² i å›¾æ ‡ï¼‰
2. æŸ¥çœ‹æˆ¿é—´è¯¦æƒ…å’Œæˆå‘˜åˆ—è¡¨
3. æµ‹è¯•"é€€å‡ºæˆ¿é—´"/"è§£æ•£æˆ¿é—´"åŠŸèƒ½
4. éªŒè¯æˆ¿ä¸»è§£æ•£åæ‰€æœ‰æˆå‘˜è¢«è¸¢å‡º

---

## å¸¸è§é—®é¢˜

### 1. è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**æ£€æŸ¥æ¸…å•ï¼š**

- æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Ÿï¼ˆè®¿é—® `https://your-server-url/health` åº”è¿”å› `{"status":"ok"}`ï¼‰
- LunaTV é…ç½®çš„æœåŠ¡å™¨åœ°å€æ˜¯å¦æ­£ç¡®ï¼Ÿ
- LunaTV é…ç½®çš„ AUTH_KEY æ˜¯å¦ä¸æœåŠ¡å™¨ä¸€è‡´ï¼Ÿ
- æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å¼€æ”¾äº†ç›¸åº”ç«¯å£ï¼Ÿ
- æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ CORS é”™è¯¯ï¼Ÿ

### 2. AUTH_KEY æ˜¯ä»€ä¹ˆï¼Ÿ

AUTH_KEY æ˜¯è§‚å½±å®¤æœåŠ¡å™¨çš„è®¤è¯å¯†é’¥ï¼Œç”¨äºéªŒè¯å®¢æˆ·ç«¯èº«ä»½ã€‚è¿™æ˜¯**å¿…éœ€**çš„é…ç½®é¡¹ï¼ŒæœåŠ¡å™¨æ²¡æœ‰æ­¤ç¯å¢ƒå˜é‡å°†æ— æ³•å¯åŠ¨ã€‚

**å¦‚ä½•è®¾ç½®ï¼š**

- Fly.ioï¼šåœ¨ `fly.toml` çš„ `[env]` éƒ¨åˆ†è®¾ç½®
- Railwayï¼šåœ¨é¡¹ç›®çš„ Variables æ ‡ç­¾é¡µæ·»åŠ 
- Dockerï¼šåœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®
- VPSï¼šåœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®

### 3. å¦‚ä½•ç”Ÿæˆå®‰å…¨çš„ AUTH_KEYï¼Ÿ

æ¨èæ–¹å¼ï¼š

```bash
# Linux/macOS
openssl rand -base64 32

# Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

# Python
python3 -c "import secrets; print(secrets.token_urlsafe(32))"
```

### 4. Fly.io å…è´¹é¢åº¦å¤Ÿç”¨å—ï¼Ÿ

Fly.io å…è´¹é¢åº¦åŒ…æ‹¬ï¼š
- 3 ä¸ªå…±äº« CPU VMï¼ˆ256MB RAMï¼‰
- 3GB æŒä¹…åŒ–å­˜å‚¨
- 160GB å‡ºç«™æµé‡/æœˆ

å¯¹äºå°è§„æ¨¡ä½¿ç”¨ï¼ˆ< 10 äººåŒæ—¶åœ¨çº¿ï¼‰å®Œå…¨è¶³å¤Ÿã€‚

### 5. æ’­æ”¾åŒæ­¥ä¸å·¥ä½œæ€ä¹ˆåŠï¼Ÿ

**è°ƒè¯•æ­¥éª¤ï¼š**

1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰
2. æŸ¥æ‰¾ `[PlaySync]` æ—¥å¿—
3. ç¡®è®¤æˆ¿ä¸»ç«¯çœ‹åˆ°ï¼š`Setting up player event listeners`
4. ç¡®è®¤æˆå‘˜ç«¯çœ‹åˆ°ï¼š`Received play:play/pause/seek event`
5. å¦‚æœæ²¡æœ‰æ—¥å¿—ï¼š
   - æ£€æŸ¥æ˜¯å¦åœ¨æ’­æ”¾é¡µé¢
   - æ£€æŸ¥æ’­æ”¾å™¨æ˜¯å¦å·²åŠ è½½ï¼ˆ`playerReady=true`ï¼‰
   - åˆ·æ–°é¡µé¢é‡è¯•

### 6. è¯­éŸ³é€šè¯å¬ä¸åˆ°å£°éŸ³ï¼Ÿ

**å¯èƒ½åŸå› ï¼š**

- éº¦å…‹é£æƒé™æœªæˆäºˆ â†’ åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸
- æ‰¬å£°å™¨è¢«é™éŸ³ â†’ ç‚¹å‡»æ‰¬å£°å™¨æŒ‰é’®å¼€å¯
- ç½‘ç»œ NAT ç©¿é€å¤±è´¥ â†’ STUN æœåŠ¡å™¨å¯èƒ½è¢«å¢™ï¼Œè€ƒè™‘ä½¿ç”¨ VPN
- æµè§ˆå™¨ä¸æ”¯æŒ WebRTC â†’ ä½¿ç”¨ Chrome/Edge/Firefox

### 7. æˆ¿é—´æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ

**æ˜¯çš„**ï¼Œæˆ¿é—´æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­ï¼š

- æœåŠ¡å™¨é‡å¯ = æ‰€æœ‰æˆ¿é—´æ¸…ç©º
- Vercel é‡æ–°éƒ¨ç½² LunaTV = ä¸å½±å“æœåŠ¡å™¨ï¼ˆæ•°æ®ä¿ç•™ï¼‰
- è§‚å½±å®¤æœåŠ¡å™¨é‡æ–°éƒ¨ç½² = æ‰€æœ‰æˆ¿é—´æ¸…ç©º

è¿™æ˜¯è®¾è®¡è¡Œä¸ºï¼Œè§‚å½±å®¤æ˜¯ä¸´æ—¶ä¼šè¯åŠŸèƒ½ã€‚

### 8. å¦‚ä½•æ›´æ–°æœåŠ¡å™¨ï¼Ÿ

**Fly.ioï¼š**
```bash
cd watch-room-server
git pull
flyctl deploy
```

**Railwayï¼š**
- æ¨é€ä»£ç åˆ° GitHubï¼ŒRailway ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²

**Dockerï¼š**
```bash
cd watch-room-server
git pull
docker-compose down
docker-compose build
docker-compose up -d
```

**VPS (PM2)ï¼š**
```bash
cd watch-room-server
git pull
npm install
npm run build
pm2 restart watch-room-server
```

### 9. æœåŠ¡å™¨æ—¥å¿—åœ¨å“ªé‡Œï¼Ÿ

- **Fly.io**: `flyctl logs`
- **Railway**: é¡¹ç›® Dashboard â†’ Deployments â†’ ç‚¹å‡»éƒ¨ç½² â†’ Logs
- **Docker**: `docker-compose logs -f`
- **PM2**: `pm2 logs watch-room-server`

### 10. å¯ä»¥åœ¨æ’­æ”¾é¡µé¢å¤–ä½¿ç”¨è§‚å½±å®¤å—ï¼Ÿ

å½“å‰å®ç°ä¸­ï¼Œæ’­æ”¾åŒæ­¥åŠŸèƒ½éœ€è¦åœ¨æ’­æ”¾é¡µé¢ä½¿ç”¨ã€‚ä½†èŠå¤©å’Œè¯­éŸ³åŠŸèƒ½ç†è®ºä¸Šå¯ä»¥åœ¨ä»»ä½•é¡µé¢ä½¿ç”¨ï¼ˆé€šè¿‡æ‚¬æµ®çª—ï¼‰ã€‚

---

## å®‰å…¨å»ºè®®

1. **ä½¿ç”¨ HTTPS**ï¼šç¡®ä¿æœåŠ¡å™¨ä½¿ç”¨ HTTPSï¼ˆFly.io å’Œ Railway é»˜è®¤æä¾›ï¼‰
2. **å¼ºå¯†ç  AUTH_KEY**ï¼šä½¿ç”¨ 32 ä½ä»¥ä¸Šéšæœºå­—ç¬¦ä¸²
3. **å®šæœŸæ›´æ–°**ï¼šå…³æ³¨ watch-room-server ä»“åº“çš„æ›´æ–°
4. **ç›‘æ§èµ„æº**ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µ
5. **å¤‡ä»½é…ç½®**ï¼šå¦¥å–„ä¿å­˜ AUTH_KEY ç­‰é…ç½®ä¿¡æ¯
6. **ç‹¬ç«‹éƒ¨ç½²**ï¼šæ¯ä¸ª LunaTV ç«™ç‚¹ä½¿ç”¨ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ˆé¿å…æˆ¿é—´æ··æ·†ï¼‰

---

## æŠ€æœ¯æ¶æ„

### å‰ç«¯å®ç°

- **æ¡†æ¶**ï¼šReact + Next.js 16.1.0
- **Socket.IO å®¢æˆ·ç«¯**ï¼šå®æ—¶é€šä¿¡
- **ArtPlayer é›†æˆ**ï¼šæ’­æ”¾å™¨äº‹ä»¶ç›‘å¬
- **WebRTC**ï¼šP2P è¯­éŸ³è¿æ¥
- **çŠ¶æ€ç®¡ç†**ï¼šReact Context API

### åç«¯å®ç°

- **Socket.IO æœåŠ¡å™¨**ï¼šWebSocket é•¿è¿æ¥
- **å†…å­˜å­˜å‚¨**ï¼šæˆ¿é—´å’Œæˆå‘˜æ•°æ®
- **JWT è®¤è¯**ï¼šAUTH_KEY éªŒè¯
- **å¿ƒè·³æ£€æµ‹**ï¼šè‡ªåŠ¨æ¸…ç†å¤±æ•ˆè¿æ¥

### åŒæ­¥æœºåˆ¶

```
æˆ¿ä¸»æ“ä½œ â†’ ArtPlayeräº‹ä»¶ â†’ Socket.IOå‘é€ â†’ æœåŠ¡å™¨å¹¿æ’­ â†’ æˆå‘˜æ¥æ”¶ â†’ æ§åˆ¶æ’­æ”¾å™¨
```

**é˜²æ­¢å¾ªç¯å¹¿æ’­ï¼š**
- `isHandlingRemoteCommandRef` æ ‡å¿—ä½
- è¿œç¨‹å‘½ä»¤è§¦å‘çš„äº‹ä»¶ä¸å†å¹¿æ’­

**å®šæœŸåŒæ­¥ï¼š**
- æ¯5ç§’å¹¿æ’­ä¸€æ¬¡æ’­æ”¾çŠ¶æ€
- ç¡®ä¿é•¿æ—¶é—´æ’­æ”¾ä¸ä¼šå¤±å»åŒæ­¥

---

## å¸è½½è¯´æ˜

### ç§»é™¤ LunaTV è§‚å½±å®¤åŠŸèƒ½

åœ¨ç®¡ç†åå°å–æ¶ˆå‹¾é€‰"å¯ç”¨è§‚å½±å®¤åŠŸèƒ½"å³å¯ã€‚ç”¨æˆ·èœå•ä¸­çš„è§‚å½±å®¤å…¥å£ä¼šè‡ªåŠ¨éšè—ã€‚

### é”€æ¯æœåŠ¡å™¨

- **Fly.io**: `flyctl destroy your-app-name`
- **Railway**: åœ¨é¡¹ç›®è®¾ç½®ä¸­ç‚¹å‡» "Delete Project"
- **Docker**: `docker-compose down -v`
- **PM2**: `pm2 delete watch-room-server`

---

## è‡´è°¢ä¸å¼•ç”¨

LunaTV çš„è§‚å½±å®¤åŠŸèƒ½åŸºäºä»¥ä¸‹å¼€æºé¡¹ç›®å¼€å‘ï¼š

### æ ¸å¿ƒä¾èµ–

- **[watch-room-server](https://github.com/tgs9915/watch-room-server)** - å¤–éƒ¨ Socket.IO è§‚å½±å®¤æœåŠ¡å™¨
  - æä¾›æˆ¿é—´ç®¡ç†ã€å®æ—¶é€šä¿¡ã€WebRTC ä¿¡ä»¤ç­‰åŸºç¡€è®¾æ–½
  - ä½œè€…ï¼š[@tgs9915](https://github.com/tgs9915)
  - è®¸å¯è¯ï¼šMIT

### å‚è€ƒå®ç°

- **[MoonTVPlus](https://github.com/mtvpls/MoonTVPlus)** - åŒæ­¥æ’­æ”¾åŠŸèƒ½å‚è€ƒ
  - æˆ‘ä»¬çš„æ’­æ”¾åŒæ­¥å®ç°å‚è€ƒäº† MoonTVPlus çš„ `usePlaySync` hook è®¾è®¡
  - æ„Ÿè°¢ MoonTVPlus å›¢é˜Ÿæä¾›çš„ä¼˜ç§€å®ç°æ€è·¯
  - ä½œè€…ï¼š[@mtvpls](https://github.com/mtvpls)

### æŠ€æœ¯æ ˆ

- **Socket.IO** - WebSocket å®æ—¶é€šä¿¡åº“
- **WebRTC** - P2P å®æ—¶éŸ³è§†é¢‘é€šä¿¡
- **ArtPlayer** - HTML5 è§†é¢‘æ’­æ”¾å™¨
- **React** - å‰ç«¯æ¡†æ¶

æ„Ÿè°¢æ‰€æœ‰å¼€æºè´¡çŒ®è€…çš„ä»˜å‡ºï¼ğŸ™

---

## è®¸å¯è¯

- LunaTV è§‚å½±å®¤å‰ç«¯ä»£ç éµå¾ª LunaTV é¡¹ç›®è®¸å¯è¯
- è§‚å½±å®¤æœåŠ¡å™¨éµå¾ª [watch-room-server](https://github.com/tgs9915/watch-room-server) çš„ MIT è®¸å¯è¯

---

## æŠ€æœ¯æ”¯æŒ

- **è§‚å½±å®¤æœåŠ¡å™¨é—®é¢˜**ï¼šåœ¨ [watch-room-server](https://github.com/tgs9915/watch-room-server/issues) æäº¤ Issue
- **LunaTV é›†æˆé—®é¢˜**ï¼šåœ¨ LunaTV é¡¹ç›®ä»“åº“æäº¤ Issue
- **åŠŸèƒ½å»ºè®®**ï¼šæ¬¢è¿æäº¤ Feature Request

---

**äº«å—ä¸æœ‹å‹ä¸€èµ·è§‚å½±çš„ä¹è¶£ï¼** ğŸ¬ğŸ¿
