## [6.1.1] - 2026-02-01

### Added

- 🔍 搜索历史UX优化：清空输入时始终显示搜索历史
- 💾 ACG搜索数据库缓存：为ACG搜索添加数据库缓存，提升搜索体验
- ✏️ 视频源编辑功能：添加视频源编辑功能，改进短剧处理逻辑
- 📊 性能监控增强：显示CPU核心数和型号名称，添加进程级指标
- 🔄 首页数据缓存：实现GlobalCacheContext首页数据全局缓存
- 💬 弹幕系统增强：防重叠开关、实时滑块控制、自定义弹幕API支持
- 📦 视频缓存LRU淘汰：实现视频缓存LRU淘汰策略
- 🔐 信任网络模式：内网部署可跳过登录认证，支持IPv6白名单
- ⚖️ 视频源权重/优先级系统：添加源权重系统优化播放源选择
- 🎌 Bangumi API优先：动漫内容详情优先使用Bangumi API
- 🔍 智能搜索变体检测：添加智能搜索变体检测，支持并行执行
- 📹 短剧备用API：添加短剧推荐和列表的备用API支持
- 🎬 DISABLE_HERO_TRAILER环境变量：添加环境变量控制预告片播放
- 📚 部署文档更新：添加HF Space和EdgeOne Pages部署指南

### Changed

- 🔨 重构短剧源聚合：动态分类检测，改进短剧源聚合逻辑
- ⚡ Cron API全面优化：并发处理、超时控制、监控、重试机制、任务统计和并行化
- ⚡ 直播频道性能优化：添加超时控制和EPG缓存
- ⚡ AI推荐请求优化：仅在后台开关启用时发送AI推荐请求
- ⚡ Redis优化：KEYS替换为SCAN避免阻塞，Upstash减少命令使用量
- ⚡ 豆瓣页面智能防抖：添加智能防抖和flushSync优化
- ⚡ 视频缓存优化：优化清理逻辑、错误处理，增加缓存上限
- ⚡ 信任网络缓存优化：24小时缓存，通过cookie版本号立即刷新配置

### Fixed

- 🐛 修复UserMenu导航卡死：通过router优化解决导航卡死问题
- 🐛 修复ACG搜索按钮显示：改进动漫内容的ACG搜索按钮显示逻辑
- 🐛 修复短剧系统：替换失效API、解决CORS问题、验证空数据、修复字段映射、自动选择分类、隐藏零评分、防止空缓存
- 🐛 修复配置订阅覆盖：保留用户手动修改的配置
- 🐛 修复源详情提前设置：移除fetchSourceDetail中过早的setAvailableSources调用
- 🐛 修复筛选标签排序选择：始终显示排序选择
- 🐛 修复Cron性能阈值：使用宽松的性能阈值评估任务
- 🐛 修复播放记录传参：将douban_id和type传递到VideoCard
- 🐛 修复移动端响应式：Spider Jar状态溢出、TVBox安全配置、信任网络配置、管理页面底部内边距、短剧卡片徽章重叠
- 🐛 修复弹幕系统：过滤占位符弹幕、纠正响应验证和超时输入UX
- 🐛 修复三星浏览器深色模式：添加color-scheme meta标签
- 🐛 修复流式代理并发请求：防止并发请求，移除Content-Length头
- 🐛 修复Vercel预告片带宽：Vercel环境禁用首页预告片视频
- 🐛 修复Kvrocks持久化：禁用外部流量监控和性能监控的持久化

## [6.1.0] - 2026-01-26

### Added

- 🤖 短剧卡片AI聊天功能：为ShortDramaCard组件添加AI聊天功能
- 📱 短剧卡片右键和长按菜单：新增短剧卡片的右键和长按上下文菜单功能
- 📊 性能监控系统：为管理后台添加完整的性能监控仪表板，支持所有API（豆瓣、搜索、列表、详情、播放记录、收藏、跳过配置、短剧）的性能监控，带过滤支持和行业基准评级系统
- 📈 流量监控系统：添加真实流量监控、外部流量域名分解、请求列表显示和可折叠区域
- 🍪 豆瓣Cookies认证支持：为详情和评论API添加豆瓣Cookies认证支持
- 💾 Kvrocks持久化和监控：为cron、豆瓣搜索API和外部流量监控添加Kvrocks持久化
- 🔍 Cron监控和API过滤：添加cron监控、API过滤和48小时自动清理功能
- ⚙️ 可配置Cron任务优化：添加可配置的cron任务优化以减少出站流量
- 🔍 TanStack Query全局状态管理：实现TanStack Query进行全局状态管理
- 🛡️ 豆瓣反爬虫验证机制：添加豆瓣反爬虫验证机制
- 🎯 广告过滤增强：基于关键词的广告检测功能
- 🌸 Mikan Project集成：添加ACG搜索双源系统（ACG.RIP和Mikan Project），支持源切换、统一响应格式和完整种子元数据，改进速度测试准确性防止浏览器缓存影响
- 💾 视频缓存系统：实现12小时TTL的视频缓存系统并添加最低系统要求

### Changed

- ⚡ 优化移动端滚动性能：使用GPU加速和iOS momentum scrolling优化移动端滚动体验
- ⚡ 优化首页性能：使用useReducer优化状态管理，使用useMemo优化昂贵的计算操作
- ⚡ 优化所有定期任务：将所有定期任务优化为1小时间隔
- ⚡ 优化性能监控：使用真实数据收集优化性能监控，改进准确性并优化首页API请求
- ⚡ 优化数据加载：移除手动虚拟批处理，使用react-window原生虚拟化
- ⚡ 优化Anime4K requestAnimationFrame：减少CPU使用率，提升视频超分辨率性能
- 🔨 重构播放页组件：提取评论区、加载屏幕、返回顶部按钮、收藏按钮、下载按钮和VideoInfoSection为独立组件，提升代码可维护性
- 🔨 重构弹幕逻辑：提取弹幕逻辑到useDanmu自定义Hook
- 🔨 重构Docker配置：移除Puppeteer/Chromium并隐藏管理UI配置
- 🔨 重构搜索页面：移除渐进式加载，优化虚拟滚动性能和加载指示器
- 🔧 更新user-agent字符串：更新到最新浏览器版本

### Fixed

- 🐛 修复视频缓存系统：添加调试日志和Docker目录权限，支持Range请求缓存，处理ReadableStream消费错误，使用douban_id替代URL哈希优化
- 🐛 修复Cron任务超时：将cron任务超时从30秒增加到5分钟
- 🐛 修复首页底部内边距：添加底部内边距防止内容截断
- 🐛 修复外部流量评级标准：调整外部流量评级标准并修复ShortDramaCard截断问题
- 🐛 修复Kvrocks数据管理：对所有流量显示应用formatTraffic，正确清理监控模块中的旧数据
- 🐛 修复统计计算与显示限制分离：将统计计算与显示限制分离
- 🐛 修复请求列表返回限制：返回时间范围内的所有请求而非限制为100条
- 🐛 修复缓存清理前创建快照：在缓存清理前创建快照以防止数据丢失
- 🐛 修复性能监控数据持久化：解决竞态条件问题，确保Docker重启后数据持久化和实时统计，防止数据丢失
- 🐛 修复性能监控CPU使用率百分比计算：纠正CPU使用率百分比计算方法
- 🐛 修复管理后台移动端布局：改进移动端布局并添加API性能监控，最后两个标签页现在可访问
- 🐛 修复数据不可用时隐藏演员和评论区：当数据不可用时隐藏演员和评论区
- 🐛 修复零时长显示：隐藏零时长并添加性能监控
- 🐛 修复bangumi日历加载问题：解决bangumi日历加载问题并为性能监控添加移动端响应式设计
- 🐛 修复VirtualDoubanGrid无限滚动触发问题：解决滚动加载异常
- 🐛 修复短剧卡片上下文菜单：添加海报和更多操作到上下文菜单
- 🐛 修复ShortDramaCard移动端长按冲突：使用div和router导航替代Link，防止移动端长按冲突
- 🐛 修复transform translateZ导致的模态框层叠上下文问题：移除导致模态框显示异常的transform属性
- 🐛 修复公告模态框z-index问题：解决移动端对话框不可见的问题

## [6.0.0] - 2026-01-22

### Added

- ✨ 用户体验增强：删除用户加载状态指示器和画质徽章自动隐藏功能
- 🚀 Puppeteer反爬虫系统：全面支持豆瓣反爬虫绕过（包括Docker/Vercel环境和评论API），集成反机器人检测、重试机制和页面加载稳定性增强
- 📱 豆瓣移动端API回退机制：添加备用数据源和详细日志追踪

### Changed

- ⚡ 主页加载性能优化：实施分批加载策略（7个请求分3批）、延迟加载非关键数据、Web Worker处理即将上映数据、React.memo优化组件，CPU使用从200-300%降至50-80%
- ⚡ 算法优化：即将上映算法复杂度从O(n²)优化到O(n)，使用Map替代reduce+find
- 🚀 User-Agent管理重构：统一管理并恢复旧版User-Agent以兼容移动端短剧API
- ⬆️ 依赖升级：puppeteer-core从24.35.0升级到24.36.0
- 🔧 架构优化：MobileActionSheet使用独立Portal容器、内容类型检测从scraper移至AI orchestrator防止超时
- ⚡ 播放进度恢复：切换剧集时自动恢复播放进度

### Fixed

- 🐛 修复用户删除功能：完善删除流程并修正Redis方法命名错误
- 🐛 修复AI类型检测：改进电影/电视剧类型检测算法，防止误识别
- 🐛 修复分辨率检测：使用视频宽度而非高度进行检测
- 🐛 修复Husky hooks兼容性：更新shebang支持Windows系统
- 🐛 修复豆瓣API问题：处理302重定向、429限流、移动端API响应格式、电视剧剧集数据、请求头设置，防止重试循环和无效数据循环

## [5.9.3] - 2026-01-13

### Added

- 📱 直播长频道名点击展开功能：为移动端长频道名添加点击展开/收起功能
- ⚡ 下载功能增强：添加片段时长追踪、时间范围和完整视频总时长显示
- 🔍 繁体中文搜索支持：添加繁体中文搜索功能，提升繁体用户搜索体验
- 📅 2026年份筛选选项：为豆瓣内容添加2026年份筛选功能
- 📚 fnOS部署指南：添加飞牛NAS（fnOS）部署指南到README文档
- 📺 TVBox源管理增强：添加手动开关和完整源解析支持
- 🖼️ 百度图片代理选项：为豆瓣图片添加百度图片代理选项，提供更多代理方式

### Changed

- ⚡ 繁体中文搜索全面优化：采用轻量级switch-chinese库、tree-shakeable导入、单例模式、多策略搜索、限制转换范围（前3个变体）、移除冗余detect()调用
- 🔧 TVBox优化：User-Agent更新为okhttp/4.1.0，优化管理后台开关布局
- 🚀 User-Agent全面升级：更新所有User-Agent到2026年最新版本（Chrome 135, Firefox 146, Safari 26, Edge 143）
- ⚡ 图片代理性能优化：改进图片代理性能和缓存策略

### Fixed

- 🐛 修复直播移动端频道名显示：优化移动端频道名显示，添加chevron指示器用于可展开名称
- 🐛 修复HeroBanner标题溢出问题：移除最大宽度限制，防止标题截断和溢出容器
- 🐛 修复Tavily API密钥未保存提醒：添加未保存更改警告
- 🐛 修复EPG频道解析：支持多行XML格式的频道解析
- 🐛 修复时间范围显示条件运算符优先级问题：纠正时间范围显示的条件判断逻辑
- 🐛 修复繁简转换应用范围：将繁体转简体转换应用到所有搜索变体，确保搜索完整性
- 🐛 修复标签按钮可见性和移动端响应式：增强标签按钮在不同设备上的可见性和响应式布局
- 🐛 修复搜索分类按钮深色模式对比度：改进深色模式下搜索分类按钮的对比度和可读性
- 🐛 修复ScrollableRow隐藏按钮捕获指针事件：防止不可见按钮响应点击事件
- 🐛 修复Zeabur部署standalone模式：启用Next.js standalone模式以支持Zeabur部署
- 🐛 修复Firefox悬停消失问题：使用box-shadow替代drop-shadow解决Firefox浏览器悬停效果消失
- 🐛 修复TVBox配置和解析：支持加密配置（Base64）、JSON注释解析、M3U8代理源键传递、完整URL解析修复直播片段500错误
- 🐛 修复TVBox功能问题：AdminConfig类型定义、编辑模式开关状态更新、解析和播放模式改进
- 🐛 修复用户菜单百度图片代理选项：在用户菜单中添加百度图片代理选项
- 🐛 修复播放页面下载配置开关：确保下载配置开关在播放页面正确生效

## [5.9.2] - 2026-01-05

### Added

- 🎬 豆瓣预告片系统增强：添加移动API自动刷新、专用刷新端点、localStorage持久化、自动重试机制、性能日志追踪，支持电视剧内容
- 💾 V2用户数据备份支持：备份/迁移系统添加V2用户数据支持
- 🎯 动漫分类默认排序：为动漫分类页面默认使用'最近热度'排序
- 👥 新用户默认用户组：为新注册用户添加默认用户组功能
- 📚 设计和实现参考文档：添加设计和实现参考章节
- 📱 TVBox诊断移动端响应式优化：优化TVBox诊断页面移动端布局
- 🔍 管理后台用户组筛选：为管理后台用户列表添加用户组筛选功能
- 🔧 代理配置系统：添加TVBox和视频播放独立代理配置，支持智能URL替换、状态检测、配置指南文档
- ⚡ M3U8下载器升级：升级M3U8下载器并发下载速度提升6倍，添加下载设置UI和边下边存自动检测
- 📺 EPG系统增强：添加调试API端点、完整解析调试信息、名称回退匹配（保持tvg-id优先）、Logo提取显示和回退图标、多显示名称支持
- ⚡ 直播直连模式：添加带智能CORS检测的直播直连播放模式，在管理后台添加CORS统计面板

### Changed

- 📱 移动导航全面重设计：底部导航采用Netflix风格全宽布局（浮动胶囊→底部停靠→全宽），ModernNav重设计为全宽样式
- ⚡ 导航性能优化：添加prefetch={false}、浅色模式支持、基于transition的FastLink组件
- ⚡ 豆瓣分类选择器滚动优化：使用requestAnimationFrame优化滚动性能
- ⏱️ 发布日历缓存时长调整：将缓存时长从24小时减少到8小时
- ⚡ 版本检查双层缓存：添加双层缓存和请求去重优化
- 📺 EPG名称匹配优化：使用反向映射优化EPG名称匹配性能

### Fixed

- 🐛 修复HeroBanner多项问题：背景图始终使用高清版本、有效预告片URL渲染、音量按钮位置避免重叠、localStorage过期URL清理并重试刷新
- 🐛 修复移动端性能和预告片缺失：优化移动端性能并解决预告片丢失问题
- 🐛 修复动漫页面排序初始化：在组件挂载时初始化默认排序值
- 🐛 修复发布日历<dl>结构支持：爬虫添加对<dl>结构的支持
- 🐛 修复TVBox诊断移动端文本溢出：防止移动端文本溢出，完成所有组件移动端响应式修复，解决额外的溢出问题
- 🐛 修复用户组和API权限：预选用户组API、显示组合权限、处理Redis标签序列化
- 🐛 修复订阅源替换逻辑：替换订阅源而非合并
- 🐛 修复视频代理应用：将视频代理配置应用到源验证端点和源测试API，在源级别而非请求级别应用
- 🐛 修复短视频跳过检测：优化短视频的跳过检测逻辑
- 🐛 修复源切换进度保留：切换视频源时保留播放进度
- 🐛 修复豆瓣分页和数据：统一分页常量防止不一致、添加去重逻辑防止重复、优化图片预加载和API代理确保CORS安全
- 🐛 修复流式下载并发写入：解决边下边存并发写入数据丢失问题
- 🐛 修复EPG多项问题：节目匹配前收集所有频道标签、数据分发到所有M3U频道名称变体、处理单行programme元素内联title标签、调试函数应用反向映射优化
- 🐛 修复直播CORS检测：优化CORS检测处理混合内容（Mixed Content）情况
- 🐛 修复直播页面移动端文本显示：优化长频道名在移动端的显示，使用line-clamp-1 md:line-clamp-2响应式截断，移除不适用于移动端的hover滚动动画，添加title属性显示完整文本，确保直连/代理模式指示器始终可见

## [5.9.1] - 2025-12-31

### Added

- 🎨 玻璃态设计应用到控制按钮：为控制按钮应用玻璃态设计效果
- 🚀 CMS代理和成人内容过滤增强：添加CMS代理功能并增强成人内容过滤
- ⚡ 图片代理超时和CORS支持优化：优化图片代理，添加超时控制和CORS支持
- 🔍 ACG种子搜索集成：添加ACG种子搜索功能
- 🛠️ cn()工具函数：添加用于Tailwind类合并的cn()实用函数
- 🔐 多Provider OIDC编辑器回调URL复制按钮：为管理后台OIDC编辑器添加回调URL一键复制功能
- 🎯 豆瓣代理API：添加带unstable_cache的豆瓣代理API和useDoubanInfo hook
- 📊 豆瓣24小时缓存和增强头像提取：为豆瓣数据添加24小时缓存并增强演员头像提取
- 🎨 CategoryBar Material UI Tabs：为直播和播放页面添加工业风CategoryBar，使用Material UI Tabs实现可靠滚动和响应式分类选择器
- 🎬 Netflix风格徽章系统：统一所有徽章（剧集徽章、通知徽章、源指示器）为Netflix风格设计
- 📅 即将上线标签页：添加即将上线内容标签页功能
- 🤖 AI功能全面增强：添加流式传输、编排器、视频上下文支持，集成豆瓣和TMDB数据，支持ID缺失时自动TMDB搜索
- 🔔 自定义确认对话框：为清除操作和继续观看记录清除添加可选确认对话框
- 🤖 Tavily仅模式支持：支持无需AI API的Tavily搜索模式，提供灵活的API验证
- 🎬 Netflix风格HeroBanner：添加带预告片和背景图的Netflix风格横幅，支持backdrop占位符
- 🎥 视频代理和图片URL重定向修复：添加视频代理功能并修复图片URL重定向
- 🔍 调试模式控制台切换：添加带控制台切换的调试模式，可绕过缓存
- 👥 观影房源切换确认对话框：为观影房添加源切换确认功能，播放记录添加douban_id支持
- ⚡ Netflix风格智能速度测试：添加带智能提前停止的实时速度测试功能
- 📊 Tavily API使用追踪：在AI配置中添加Tavily API使用情况追踪，支持单个密钥刷新
- 🔍 2026年发布数据爬虫：添加首页爬虫获取2026年发布数据

### Changed

- 📱 播放页UI增强：移动端优先设计并重组控制器布局
- 🎨 LinuxDo OIDC Logo更新：使用官方设计Logo并适配UI
- ⚡ Tailwind v4规范类语法升级：升级到Tailwind v4规范语法
- 🔄 替换手动滚动为原生scrollIntoView API：使用浏览器原生API替代手动滚动实现
- 🔄 移除CategoryBar：恢复到之前版本，更新观影房文档为多平台Docker镜像
- ⚡ 搜索性能优化：优化季度搜索数字变体生成和变体搜索策略，提升搜索速度
- 🔄 用自定义ConfirmDialog替代原生confirm：使用自定义确认对话框组件
- ⚡ 首页所有ScrollableRow启用虚拟化：修复移动端卡顿问题
- ⚙️ HeroBanner优化：标准化缓存时长为4小时，重构性能并提取自定义hooks
- 🔄 提升AI权限检查到页面级别：实现一致的状态管理
- 🚀 升级所有爬虫和代理到2025最佳实践：全面优化爬虫和代理实现

### Fixed

- 🐛 修复观影房配置保存前过早获取统计信息：分离已保存配置和本地输入状态，防止过早API调用
- 🐛 修复OIDC用户登录时间记录：为现有和新用户立即记录登录时间，解决显示未知时间和待激活状态问题
- 🐛 修复旧版移动浏览器backdrop-filter兼容性：使用95%不透明度实心背景替代模糊效果，自动修复36个使用backdrop-blur类的文件，确保旧版移动系统UI完整渲染
- 🐛 修复缺失或无效海报图片显示：VideoCard在图片加载失败后设置fallback SVG占位符，过滤空白vod_pic字段，确保所有视频卡片显示正确占位符而非空白
- 🐛 修复模态框内容截断问题：修复Tailwind模态框结构、OIDC模态框、OIDC提供商模态框桌面端滚动等内容截断问题，使用正确结构和min-h-0
- 🐛 改进移动端响应式：优化认证页面、观影房和OIDC配置的移动端显示和布局
- 🐛 修复搜索结果人工限制丢弃有效匹配：移除人为设置的结果数量限制
- 🐛 修复直播CategoryBar滚动问题：解决对象依赖导致的滚动循环、滚动跳跃、手动/自动冲突等问题
- 🐛 修复返回顶部按钮：修复播放页面ACG返回顶部按钮和网盘模态框返回顶部按钮的定位和功能
- 🐛 简化非活跃用户清理逻辑：仅检查最后登录时间
- 🐛 修复Docker相关问题：解决短剧API问题、HTTPS支持、配置缓存问题等Docker部署相关多个问题
- 🐛 统一首页和UserMenu发布日期计算：统一跨组件的日期计算逻辑
- 🐛 为普通用户统计VideoCard光环效果添加悬停缩放动画：改进交互效果
- 🤖 AI功能修复和改进：修复推荐提取、YouTube解析、流式模式、Markdown渲染、Tavily API密钥输入、欢迎消息、聊天历史同步等多个AI功能问题
- 🤖 Tavily搜索模式优化：支持SSE流式传输、移除默认值回退、改进用户指导和友好提示
- 🤖 AI流式传输优化：立即显示聊天消息、Markdown格式欢迎消息、显示预设按钮
- 🤖 AI助手动态适配站点名称：使AI助手自动适应站点名称
- 🎨 修复粘性筛选栏问题：使用负边距技术消除间隙、修复内容穿透、使用精确响应式负top值优化不同屏幕尺寸显示
- 🎬 修复切换视频源时保留剧集编号：解决源切换后剧集编号丢失问题
- 🎬 修复HeroBanner问题：修复首次加载视频自动播放、调整横幅高度、启用视频、使用剧照作为背景、修复动漫分类
- 👥 修复观影房源切换问题：改进源切换检测、使用doubanId和标题加年份匹配视频、使用状态值匹配、使用router.push带reload标志、重新加载视频数据、使用React key prop强制组件重新挂载
- 📱 修复旧版iOS Safari认证页面崩溃：解决iOS Safari兼容性问题
- 🎬 修复豆瓣预告片缓存问题：解决预告片URL过期问题，调整CDN缓存和unstable_cache策略，将CDN缓存从24小时降至30分钟

## [5.9.0] - 2025-12-27

### Added

- 🔐 多Provider OIDC支持：添加多Provider模式，支持同时配置多个OAuth提供商
- 🔐 Facebook OAuth登录支持：集成Facebook OAuth认证
- 🔐 微信和Apple OAuth登录支持：添加微信和Apple Sign In认证
- 🔐 Apple JWKS URI支持：为Apple Sign In添加JWKS URI配置
- 🔐 OIDC认证和V2用户存储：实现OIDC认证并迁移到V2用户存储系统
- 👥 观影房功能：添加外部服务器集成的多人观影房功能
- 👥 观影房离开/解散功能：支持房间管理和hook顺序优化
- 👥 观影房集成到播放页：在播放页面集成观影房功能
- 👥 观影房同步增强：添加视频展示和智能控制
- 👥 观影房按钮全局布局：将观影房按钮移至全局布局
- 📥 M3U8客户端下载功能：添加M3U8视频客户端下载支持
- 📥 批量剧集下载功能：支持批量下载多个剧集
- 🎬 播放器缓冲优化：添加三种缓冲模式优化
- 🎨 Anime4K超分辨率：使用WebGPU实现视频超分辨率
- 🎯 自定义广告过滤代码：添加自定义广告过滤规则功能
- 📊 收藏API性能监控：为收藏功能添加性能监控
- 🔘 自定义广告过滤重置按钮：添加独立的重置和恢复默认按钮

### Changed

- 🔐 迁移到V2用户存储：使用SHA256加密的V2用户存储系统
- 👥 重构观影房全局状态管理：改进连接和状态管理
- 👥 优化剧集显示和用户名加载：改善观影房用户体验
- 📊 优化收藏同步超时：移除过多的错误提示
- 🍪 改进Cookie加载检测：使用持久轮询检测
- 🎯 观影房视频卡片显示：显示带海报的视频卡片

### Fixed

- 🔐 改进GitHub OAuth用户信息处理：添加GitHub专用API headers，支持私有邮箱获取
- 🔐 修复GitHub OAuth集成问题：使用正确的scope和Accept header，排除id_token验证
- 🔐 修复OIDC redirect_uri：支持本地开发和反向代理环境的正确重定向
- 🍎 添加Apple Sign In的POST处理器：支持form_post响应模式
- 🔐 修复Apple Sign In的OIDC发现：改进Apple OAuth配置
- 🔐 修复Zeabur和反向代理的OIDC redirect_uri问题：解决部署环境的重定向问题
- 🔐 修复OIDC Provider检测：通过issuer正确识别Provider
- 🔐 修复OIDC注册和用户同步：确保新用户正确创建和显示
- 🔐 修复admin面板包含V2用户：getAllUsers()现在包含OIDC用户
- 🔐 修复注册后自动登出：改进配置缓存失效机制
- 🔐 修复注册和登录Cookie名称不一致：统一Cookie命名
- 🔐 修复客户端路由注册Cookie未应用：确保Cookie正确设置
- 🔐 添加oidc-register到中间件排除列表：允许OIDC注册页面访问
- 🔐 修复用户注册和创建问题：确保新用户正确创建
- 🔐 恢复V1用户存储：为所有用户使用V1存储
- 📥 修复Windows上的M3U8下载和husky：改进Windows兼容性
- 🖼️ 修复图片预加载中的querySelector错误：处理格式错误的URL
- 👥 修复成员离开房间和播放同步问题：改进同步机制
- 👥 导出WatchRoomContextType并添加连接状态指示器：改进类型安全
- 👥 修复房间创建/加入立即更新UI状态：改善用户反馈
- 👥 修复stats API使用POST方法：更新API调用方式
- 👥 修复观影房用户名硬编码问题：动态从auth cookies获取用户名
- 👥 修复剧集切换同步：使用URL videoId而非detail.vod_id
- 👥 修复剧集切换自动跟随房主：无需确认
- 👥 修复剧集切换同步并适配watch-room-server权限：改进权限处理
- 👥 修复观影房首次访问401和访客显示问题：改进认证和显示
- 👥 启用剧集切换同步：读取URL index参数
- 👥 调整观影房按钮位置：位于返回顶部按钮上方
- 👥 修复跟随房主时避免退出房间：防止页面刷新
- 👥 修复用户名显示问题：改进视频卡片逻辑
- 🎯 修复SSR导致用户名默认为guest：解决服务端渲染问题
- 🐛 修复首次加入房间的guest名称问题：改进用户名初始化
- 📝 添加用户名初始化问题的详细日志：便于调试
- 🎨 修复自定义广告过滤保存：正确的HTTP方法和请求负载
- 🛡️ 为CustomAdFilterConfig添加JSON解析错误处理：增强稳定性

## [5.8.0] - 2025-12-24

### Added

- 🎯 AI推荐按钮：在ModernNav导航栏添加AI智能推荐按钮，全局可用
- 🎬 短剧自动跳集：备用API集数不可用时自动跳到下一集
- ⚡ 升级到Next.js 16.1 + Tailwind CSS 4.1 + React 19：享受最新框架性能提升
- 🎭 TMDB演员作品备用：添加TMDB作为演员作品搜索的备用数据源
- 💾 演员作品缓存：缓存演员作品信息2小时，减少API请求
- 🎬 演员作品内联显示：使用搜索API在播放页面内联显示演员作品
- 🎨 交互式演员作品查看器：在播放页面添加交互式演员作品浏览功能
- ⚙️ 弹幕综合设置：添加完整的弹幕设置面板，支持速度、透明度、字体等配置
- 🎨 弹幕设置集成：将弹幕配置集成到全局设置面板

### Changed

- ⚡ AI聊天性能优化：优化聊天弹窗性能，消除输入延迟
  - 添加100ms防抖滚动，减少过度滚动动画
  - 使用requestIdleCallback实现300ms防抖的异步localStorage写入
  - 使用useCallback记忆化所有事件处理函数
  - 创建记忆化MessageItem组件，使用useMemo缓存格式化内容
  - 输入延迟减少85-90%，消息重渲染减少70-85%
- 🎨 VideoCard容器查询：为VideoCard添加Tailwind 4容器查询支持
- ⚡ React 19性能优化：使用useTransition优化非紧急更新，添加图片优先级
- ⚡ 收藏乐观更新：使用React 19的useOptimistic优化收藏功能，合并重复useEffect
- 🖱️ 用户菜单悬停优化：优化用户菜单悬停过渡性能
- 🎨 Tailwind CSS 4.1优化：优化globals.css以适配Tailwind CSS 4.1
- 🔧 Telegram用户自动清理：为Telegram用户添加createdAt字段以启用自动清理

### Fixed

- 🐛 短剧错误信息显示：在短剧播放器中显示实际的API错误信息
- 🔧 备用API错误处理：改进备用API字符串响应的错误处理
- 🎯 AI模态框居中：修复AI模态框居中问题，确保AI按钮全局可用
- 🖼️ TMDB API白屏修复：使用TMDB API路由替代客户端导入，解决白屏错误
- 🔑 演员缓存键格式：修正演员缓存键格式问题
- 🎮 弹幕速度设置：修复弹幕速度设置以匹配原生插件数值

## [5.7.1] - 2025-12-13

### Added

- 🎨 毛玻璃效果控制栏插件：为播放器添加现代化液态玻璃（liquid-glass）悬浮控制栏效果
- 💬 豆瓣用户评论功能：在播放页面展示豆瓣短评，提供用户真实观影评价参考
- ⭐ 全局收藏按钮：为所有视频卡片和短剧卡片添加收藏按钮，快速收藏喜爱内容
- 🔄 自动同步收藏元数据：从播放页面自动同步更新收藏内容的元数据
- 🔌 备用API支持：为短剧添加备用API支持，增强短剧元数据获取能力
- 📊 收藏过滤、排序和统计：支持按类型过滤、多种排序方式和详细统计信息
- 🎌 动漫分类支持：在收藏过滤中添加动漫（anime）类别

### Changed

- ⚡ 首屏图片加载优化：优化首屏内容的图片加载策略，提升首屏渲染速度
- 🎯 可选虚拟化滚动：为ScrollableRow添加可选的虚拟化支持，提升长列表性能
- ⏱️ 延迟详情请求：使用requestIdleCallback延迟详情请求，优化主线程性能
- 🎨 VideoCard渲染优化：优化VideoCard组件渲染性能，减少不必要的重渲染
- 🎬 禁用卡片动画：禁用卡片动画并简化motion配置，提升整体流畅度

### Fixed

- 🔧 控制栏布局修复：回归官方liquid-glass实现，修复拖动进度条时控制栏漂移的问题，通过按钮自动缩小防止溢出
- 📺 短剧卡片集数显示：始终获取并显示短剧的真实集数
- 🔗 收藏内容播放修复：为收藏内容生成正确的播放URL
- 🐛 豆瓣源参数修复：防止豆瓣源参数导致播放页面崩溃
- 🎯 分类过滤修复：排除直播频道和番剧，修正电视剧type字段，改善收藏分类准确性
- 📊 集数徽章显示：API可用时立即显示集数，失败或仅1集时隐藏徽章
- 🏷️ 类型识别增强：正确识别短剧、综艺等类型，防止空字符串导致分类错误
- 🔄 短剧搜索竞态条件：解决清空搜索时的竞态条件问题
- 🔌 备用API优化：添加专用代理、HTTPS转换、数据验证等，提升短剧内容获取成功率

## [5.7.0] - 2025-12-06

### Added

- 🎭 演员头像和推荐影片功能：在播放页面展示演员头像和类似影片推荐
- 🔍 直播源标签页搜索功能：为直播源标签页添加搜索功能，快速查找直播频道

### Fixed

- 🖼️ 修复演员头像显示问题：
  - 支持 `/celebrity/` 和 `/personage/` URL 格式
  - 过滤默认占位符头像
  - 实现图片代理自动修复（从 direct 迁移到 server 模式）
  - 自动迁移旧版 localStorage 配置
- 📱 修复推荐卡片移动端导航问题：
  - 使用捕获阶段事件监听拦截 VideoCard 内部事件
  - 添加长按检测（500ms）以保留操作菜单功能
  - 修复移动端点击跳转到页面顶部的问题
  - 保留所有 VideoCard hover 效果和 UI 显示
- 🎯 修复推荐卡片事件冲突：
  - 使用 `addEventListener` 的捕获模式优先拦截事件
  - 添加 `stopImmediatePropagation` 防止事件干扰
  - 短按跳转，长按显示菜单，完美兼容移动端和桌面端
- 🔧 修复日期计算不一致性：修复首页和发布日历之间的日期计算差异

### Changed

- 🖼️ 默认图片代理模式改为 server：在所有组件中将默认图片代理从 direct 改为 server 模式
- 📅 演员信息显示优化：为演员姓名和角色添加 tooltip，防止文本截断
- 📦 升级依赖：升级 hls.js 到 v1.6.15

## [5.6.3] - 2025-11-17

### Added

- 🎉 短剧多源搜索功能：为短剧内容启用多源搜索，支持从横幅和卡片触发的详情集成
- 🎨 虚拟滚动增强功能：添加自动滚动和图片预加载，提升浏览体验
- 📊 智能分布算法：为即将上映部分实现智能时间分布算法

### Changed

- 🔐 SessionTracker兼容性增强：同时支持auth和user_auth cookies，提升会话追踪稳定性
- 📈 发布日历API限制提升：从20增加到100，显示更多即将上映内容
- 🔍 即将上映时间范围扩展：从30天扩展到90天，提供更长期的内容预览
- 📅 今日发布硬性限制：防止今日发布内容在即将上映部分占主导地位
- 📊 即将上映时间分布算法改进：优化即将上映内容的展示分布
- 📺 频道名称滚动动画：为直播视图中的频道名称添加滚动文字动画

### Fixed

- 🔧 修复videoDoubanId检查时渲染0值的问题：防止豆瓣ID为0时的错误显示
- 🎯 智能源过滤实现：自动过滤class字段和源中的零值以及无集数的视频源
- 🚫 过滤无效数据：清理class字段中的零值和没有集数的源
- 📺 更新availableSources状态：确保源选择器仅显示有效视频源
- 🔝 改进全屏按钮可见性：优化小屏幕设备上全屏按钮的显示
- 🎪 隐藏收藏中的占位集数：避免显示短剧的99集占位符误导用户
- 🚫 防止短剧源错误添加：确保短剧源不被添加到非短剧内容
- 🎯 修复VideoCard徽章显示：支持所有发布状态类型的徽章正确显示
- ⏰ 解决日期比较时区问题：修复即将上映过滤中的时区导致的日期判断错误
- 🔗 修复HeroBanner播放链接：添加stype参数确保正确跳转
- 🎯 修复HeroBanner搜索匹配：使用douban_id替代标题匹配，提升搜索准确性
- 🎬 改进短片标题搜索：优化短片标题的模糊搜索算法准确性
- 🔝 修复跳过按钮z-index：防止跳过按钮覆盖导航栏
- 📍 修复跳过按钮定位：确保跳过按钮保持在播放器容器内的固定位置
- ❤️ 添加专用收藏心形按钮：为收藏面板添加专用可点击心形按钮
- 🎯 隐藏收藏悬停按钮：防止浮动心形按钮干扰用户操作
- 🗑️ 移除收藏面板重复元素：清理收藏面板中的重复心形和日期标签
- 🧹 清理已上映内容播放URL：确保已上映的即将上映内容可正常播放
- 🏷️ 智能源标签系统：支持动态状态和配色主题的源标签
- 🎨 动态发布徽章：根据发布状态动态显示徽章并隐藏占位集数
- ▶️ 启用已上映收藏播放：智能检测即将上映内容是否已上映并启用播放
- 🔄 智能去重和动态状态：优化即将上映内容的去重和状态更新逻辑
- 🎯 增强M3U8广告过滤：添加SCTE-35检测提升广告过滤效果
- 🔧 修复带副标题的去重逻辑：改进标题重复检测算法
- 📊 修复卡片z-index冲突：防止所有卡片组件覆盖导航栏
- 📱 修复VideoCard悬停z-index：解决VideoCard悬停/点击时覆盖导航栏的问题
- 🎯 修复工具提示z-index冲突：确保VideoCard工具提示不与导航栏冲突
- 🔧 修复短剧源显示问题：确保短剧源正确显示在源选择器中

## [5.6.2] - 2025-11-06

### Added

- 🎬 英雄横幅全品类内容支持：为所有内容类型（电影、剧集、综艺、短剧、番剧）添加详情描述到英雄横幅
- 📅 即将上映日历功能：新增即将上映section，展示未来30天内的电影和电视剧上映信息
- 🖼️ 发布日历海报图片提取：实现从manmankan网站抓取即将上映内容的封面图片（支持懒加载data-original）
- 🎨 Aurora网格渐变背景：为发布日历页面实现Aurora Mesh Gradient背景，增加动画blob效果
- 📱 移动端横幅滑动卡片布局：实现移动端友好的可滑动卡片式横幅布局，支持触摸手势导航
- 🔖 即将上映类型徽章：为即将上映卡片添加电影/电视剧类型标识徽章（左上角）
- ⭐ 即将上映收藏功能：支持收藏即将上映内容，上映后自动变为可播放状态
- 🔄 收藏集数自动更新：播放页面自动更新收藏的占位符集数（99集）为真实集数
- 📺 直播流DVR后加载检测：
  - 播放器加载后使用video.seekable API检测DVR/时移支持
  - 检测到可seek范围超过60秒时显示通知横幅
  - 添加启用进度条按钮以DVR模式重新加载播放器（isLive: false）
  - 显示可seek时间范围（分钟）供用户参考
  - 仅在未启用DVR模式时检测，避免冗余检查

### Changed

- 🎨 发布日历页面UI美化：优化发布日历页面视觉效果，添加渐变背景和现代化设计
- 📱 大屏幕响应式布局优化：改进大屏幕设备上的响应式布局效果
- 🎯 即将上映内容去重：基于标题对即将上映数据进行去重，保留最早上映日期
- 🚫 即将上映内容禁用播放：未上映内容显示敬请期待而非播放按钮，防止用户困惑
- 👁️ 隐藏即将上映集数徽章：不显示即将上映内容的占位符集数，避免误导用户
- ⚡ 播放进度保存频率优化：增加播放进度保存间隔以减少网络开销
- 🔍 新集数检测优化：跳过播放期间的冗余fetch请求，优化性能
- 📊 播放记录请求优化：减少播放记录API请求频率，降低网络负担

### Fixed

- 🖼️ manmankan图片代理支持：添加manmankan.com的Referer支持到图片代理，绕过防盗链
- 🔧 豆瓣详情剧情摘要提取修复：修复从豆瓣详情中提取完整剧情摘要的问题
- 🗑️ 豆瓣详情缓存失效处理：当plot_summary缺失时自动失效缓存，确保数据完整性
- 🔗 短剧横幅更多按钮链接修复：修正短剧类别在英雄横幅中的更多按钮跳转链接
- 🔝 播放页返回顶部按钮位置修复：调整返回顶部按钮在移动端的响应式位置，防止与更多菜单重叠
- 📐 搜索页z-index修复：防止底部导航被返回顶部按钮遮挡
- 🎬 横幅内容截断修复：防止描述过长时英雄横幅内容被截断
- 🎮 视频播放器z-index修复：修复移动端底部菜单被视频播放器遮挡的问题
- 🔍 移动端短剧搜索参数修复：使用正确的query参数进行移动端短剧搜索
- 🐛 isUpcoming变量声明顺序修复：移动isUpcoming声明到useEffect之前，解决编译错误
- 📦 getAllFavorites导入修复：使用正确的静态导入替代动态import，修复TypeScript编译错误
- 🎯 异步详情获取修复：修正所有英雄横幅项目的异步详情获取逻辑

## [5.6.1] - 2025-11-01

### Added

- 🎨 英雄横幅和现代化导航UI：添加自动轮播的英雄横幅和渐变背景，重新设计导航（桌面端水平顶部栏+移动端Liquid Glass底部导航）
- 🎯 TVBox智能搜索代理：添加TVBox智能搜索代理功能，支持成人内容过滤和UI控制
- 📋 快速复制TVBox配置模式按钮：新增TVBox配置模式的快速复制按钮，简化配置流程
- 🔧 成人内容路径前缀支持：为成人内容过滤添加路径前缀支持功能
- 📤 视频源导出格式选择：新增导出格式选择，支持数组和配置文件格式
- ⏱️ 批量成人内容标记成功提示自动关闭：为批量成人内容标记成功提示添加自动关闭计时器

### Changed

- 📱 修复移动端页面过度间距问题：减少移动端头部高度并应用更紧凑的布局，修复所有页面的过度间距
- 🎨 优化短剧页面加载指示器：改进短剧页面在浅色模式下的加载指示器显示效果

### Fixed

- 🔧 修复卡片和徽章的z-index层级问题：纠正卡片和徽章的z-index层级，防止出现叠加显示问题
- 🎭 降低剧集徽章z-index：降低剧集徽章的z-index值，防止遮挡模态框
- 📱 增加移动端PageLayout底部内边距：增加移动设备上PageLayout的底部内边距，改善布局
- 🔝 提高AI推荐模态框z-index：提高AI推荐模态框的z-index值，防止徽章重叠
- 🖼️ 修复豆瓣海报图片403错误：通过代理路由豆瓣海报图片，防止出现403禁止访问错误
- 🎬 移除短剧页面白色背景框：移除短剧页面的白色背景框，优化视觉效果
- 🔄 还原短剧加载指示器样式改进：还原对短剧加载指示器在浅色模式下的样式改进
- 🐛 修复Webkit光标和iPadOS进度条问题：修复Webkit浏览器的光标显示和iPadOS设备的进度条交互问题

## [5.6.0] - 2025-10-27

### Added

- 🔐 Telegram Magic Link身份验证：实现基于Telegram的Magic Link认证功能，提供更安全便捷的登录方式
- 🤖 自动设置Telegram Webhook：生成Magic Link时自动配置Telegram webhook，简化部署流程
- 🔍 资源搜索端点权限验证：为/api/search/resources端点新增用户身份验证检查，提升API安全性
- 🎯 源浏览器完整功能集成：新增源浏览器和测试模块到管理后台，支持源站测试和管理
- 🎨 源浏览器增强UI设计：优化源浏览器和测试模块UI界面，提升用户体验

### Changed

- 📱 源浏览器移动端布局优化：改进移动端搜索控制和响应式布局，适配各种屏幕尺寸
- 🎯 侧抽屉替代居中弹窗：用侧边抽屉替代源测试结果的居中弹窗显示，优化空间利用
- 📐 抽屉卡片布局优化：优化抽屉模式下的卡片布局和间距

### Fixed

- 🔧 防止Upstash用户自动删除：修复Upstash环境下用户被自动删除的问题，并清理登录统计数据
- 🎭 抽屉z-index层级修复：增加抽屉z-index防止移动端导航栏覆盖问题
- 🔄 防止源站跳转问题：修复源浏览器中的源站意外跳转问题
- 🚪 Portal渲染修复视口定位：使用Portal渲染抽屉以修复视口定位问题
- 📱 预览弹窗z-index修复：修复源浏览器预览弹窗z-index防止被头部覆盖
- 🔒 移动端底部导航遮挡问题：防止移动端底部导航栏遮挡预览弹窗内容
- ✨ 移除短剧分类按钮闪烁效果：移除短剧分类按钮的闪烁动画效果，优化视觉体验

## [5.5.8] - 2025-10-16

### Added

- 🎬 新增视频源导入/导出功能：支持批量管理视频源配置，便于备份和迁移

### Changed

- 🎨 优化VideoCard徽章布局和定位：改进视频卡片徽章的视觉效果和位置
- 📱 优化返回顶部按钮位置：调整按钮位置更贴近底部，提升移动端体验
- ⚡ 优化短剧分页分类UI闪烁问题：通过智能加载状态管理，切换分类时保持旧内容显示直到新内容加载完成，大幅减少UI闪烁

### Fixed

- 🔧 修复片尾自动播放导致跳跃2集的问题：
  - 添加冷却机制防止双集跳过
  - 在SkipController添加episodeIndex prop修复剧集切换时的自动跳过
  - 防止视频结束时保存播放进度以避免不正确的恢复位置
  - 重置lastProcessedSegmentRef状态防止重复处理片段
  - 添加详细调试日志协助排查匹配失败
  - 优化剧集切换后的自动跳过重置机制
- 🎯 修复VideoCard装饰元素的悬停缩放和z-index同步问题
- 🔄 改进视频卡片装饰覆盖层的悬停效果同步
- 📐 优化视频卡片徽章和装饰覆盖层的z-index层级
- 🖱️ 修复VideoCard工具提示定位和布局问题
- 🔨 修复返回顶部按钮的定位和可见性问题
- 🎭 修复加载旋转器边框和工具提示显示问题
- 🐛 修复Docker工作流自动构建版本标签功能
- 🔍 修复merge job中版本检测总是变化的问题
- 🛠️ 为merge job版本检查添加调试输出

## [5.5.7] - 2025-10-11

### Added

- 🎨 玻璃态渐变UI全面升级：为首页、侧边栏、视频卡片、播放页、短剧页面等应用玻璃态设计、渐变主题和流畅动画效果
- 🔐 TVBox用户专属Token系统：新增每个用户独立的TVBox token和视频源访问限制功能
- 📊 Docker自动版本标签：为CI/CD流水线添加自动版本检测功能，实现Docker镜像自动打标签

### Changed

- 🎯 剧集选择器和视频源切换器UI增强：优化剧集选择器和视频源切换器的视觉效果，添加渐变和动画
- 🎬 播放页UI优化：为移动端和桌面端播放页面增强UI体验，添加渐变效果
- 📱 豆瓣页面筛选面板美化：优化豆瓣页面筛选面板和分页状态的视觉设计
- 🎭 短剧页面UI美化：为短剧页面应用渐变设计和动画效果
- 🛠️ 管理后台加载和空状态美化：优化管理页面的加载和空状态显示效果
- 📏 播放页返回顶部按钮位置调整：将返回顶部按钮移至右下角位置
- 🎯 VirtualDoubanGrid完成消息优化：改进Bangumi模式下的完成提示消息

### Fixed

- 🔥 彻底修复片尾自动播放双集跳跃问题：通过多层防护机制完全解决片尾自动播放时跳2集的bug
  - 添加`lastProcessedSegmentRef`防重复触发机制，确保同一片段只处理一次
  - 添加`videoEndedHandledRef`防止同一video:ended事件被多个监听器重复处理
  - 移除SkipController中的1秒延迟，避免延迟期间触发video:ended事件
  - 延迟重置`isSkipControllerTriggeredRef`标志至2秒，适配短剧异步URL解析
- 🎭 剧集选择器标签页文字不可见问题：修复剧集选择器中标签页文本隐形的问题
- 🔄 跳过配置段落长度未定义错误：修复SkipController中segments.length未定义导致的错误
- ⚙️ 跳过设置对话框UX优化：新增多种关闭选项提升用户体验
- 🎯 切换集数时自动跳过设置重置问题：修复切换集数时跳过设置被重置的问题，确保用户设置持久化
- 📝 跨组件自动跳过设置同步：修复所有UI组件之间的自动跳过设置同步问题
- 🔁 用户设置跨集数和跨进度保持：修复用户跳过设置在seek和切换集数时的持久化问题
- 📊 番剧模式继续观看卡片集数显示：修复继续观看卡片的集数显示与播放统计页面保持一致

## [5.5.6] - 2025-10-08

### Added

- 🎯 片头片尾跳过实时标记按钮：新增实时标记片头片尾时间点的交互按钮，方便用户快速配置跳过设置
- 🎮 可拖拽跳过配置悬浮窗：新增可拖拽的跳过配置悬浮窗组件，支持触摸操作和位置持久化存储
- 📱 移动端跳过设置按钮显示：修复移动端设备上跳过设置按钮的显示问题
- 🎬 片尾剩余时间模式跨集数支持：实现片尾跳过配置的剩余时间模式在切换集数时的正确处理
- 📊 继续观看卡片完结徽章：为所有继续观看部分添加已完结系列徽章显示
- 🔍 TVBox深度JAR诊断系统：新增JAR文件头验证的深度诊断系统和智能健康检查

### Changed

- 📐 可拖拽跳过配置悬浮窗边界限制：优化悬浮窗拖拽边界限制和位置持久化机制
- 🎨 Zeabur部署指南简化：简化Zeabur部署指南为仅Docker镜像方式，移除复杂的GitHub集成部署
- 📝 Zeabur部署指南KVRocks配置更正：修正KVRocks持久化卷路径说明，从`/data`改为正确的`/var/lib/kvrocks/db`
- 🌐 Zeabur一键部署模板链接更新：更新README中的Zeabur一键部署模板链接
- 🏠 Zeabur部署完成后域名设置提醒：添加部署完成后需要设置访问域名的重要提示
- 📚 README锚点链接修复：修复设置访问域名部分的锚点链接

### Fixed

- 🔧 original_episodes损坏和无限API请求防护：防止original_episodes数据损坏导致的无限API请求问题
- 🛡️ 剧集检测时自动original_episodes更新防护：防止剧集检测过程中original_episodes被自动更新
- 📝 剧集更新检测时original_episodes覆盖防护：防止剧集更新检测时original_episodes字段被意外覆盖
- 🎬 片尾跳过剩余时间模式跨集数修复：修复片尾跳过配置在剩余时间模式下切换集数时的处理逻辑（多次优化）
- 🔄 KVRocks跳过配置首次加载问题：修复KVRocks环境下跳过配置首次加载不生效的问题
- 📊 跳过配置架构重构：采用新的跳过配置架构设计，实现更稳定可靠的片头片尾跳过功能
- 🎯 观看更新卡片闪烁优化：通过排序updatedSeries防止继续观看卡片闪烁
- 🌐 Zeabur部署指南和演示站点更新：更新Zeabur部署指南内容并添加最新演示站点链接

## [5.5.5] - 2025-10-06

### Added

- 🎯 TVBox诊断增强：新增完整诊断详情展示到用户页面和管理后台，包括基本信息、Spider状态、配置字段等
- 🔍 Spider管理系统：实现Spider探测、缓存、降级代理机制，支持多个Spider JAR备份源(gaotianliuyun作为第三备份源)
- 📊 管理统计卡片增强：新增新剧集卡片和继续观看卡片到管理员统计页面，优化布局显示
- 🎬 已完结系列徽章：基于vod_remarks添加已完结系列徽章功能，支持搜索API和详情API的remarks检测
- 📝 双语README和完整文档：新增CC BY-NC-SA 4.0协议声明、Vercel部署指南、Selene移动应用说明、重要声明章节
- 🔄 Spider状态API：新增Spider状态查询端点，增强TVBox诊断UI显示

### Changed

- ⚡ Spider JAR优化：优先使用GitHub raw源以减少失败尝试，实现快速模式和本地代理降级
- 🔄 缓存机制优化：Kvrocks/Upstash使用内存缓存以解决慢加载问题，防止localStorage写入
- 🎯 原始集数逻辑改进：信任客户端提供的original_episodes，使用recordKey精确匹配source+id而非标题匹配
- 📊 搜索API优先级：优先使用搜索API的remarks而非详情API来判断完结状态
- 🌐 TVBox站点名称动态化：使用动态站点名称替代硬编码的LunaTV
- 📦 react-window升级至v2.2.0：升级虚拟滚动组件至最新版本
- 🎨 README优化：修复目录锚点链接，更新Docker配置说明，添加Selene移动应用章节

### Fixed

- 🔧 original_episodes更新逻辑完善：自动修正无效的original_episodes值(大于total_episodes时)，当用户观看新剧集时更新，保留原始值不被覆盖
- 💾 缓存更新时序修复：在数据库更新成功后清除缓存而非之前，确保数据一致性
- 🔄 播放记录缓存刷新：当original_episodes更新时强制刷新播放记录和watching-updates缓存
- 📱 QuotaExceededError修复：watching-updates使用内存缓存解决localStorage配额超限问题
- ⚙️ ESLint规范修复：将siteExt改为const以修复prefer-const警告
- 🎯 实时数据同步：为Kvrocks存储模式确保实时数据同步，优化播放记录和watching-updates同步机制
- 🔍 强制刷新参数：为checkWatchingUpdates和UserMenu添加forceRefresh参数以绕过缓存
- 🗄️ 数据库original_episodes获取：总是从数据库获取新鲜的original_episodes数据，确保更新检测准确
- 🎭 TVBox配置问题：修复yingshicang模式下的硬编码spider jar问题，修复长URL溢出显示，优化TVBox页面布局
- 🔐 localStorage写入限制：防止saveUserCache在使用Kvrocks/Upstash时写入localStorage
- 📝 UserMenu存储类型初始化：优化存储类型初始化以防止冗余渲染

## [5.5.4] - 2025-10-03

### Added

- 🔐 TVBox普通用户访问支持：新增/api/tvbox-config端点，允许所有登录用户访问TVBox配置
- 🎨 登录注册界面现代化：升级登录/注册页面，添加动态随机壁纸和现代化UI设计
- 💾 日历缓存数据库迁移：将日历缓存从localStorage迁移至数据库，支持跨设备同步

### Changed

- 🎯 登录注册链接卡片化：将登录/注册链接升级为渐变按钮卡片样式
- 📊 前端数据库缓存优化：实现前端数据库缓存优化，提供即时加载体验
- 📦 react-window升级至v2.2.0：升级虚拟滚动组件至最新版本

### Fixed

- 🔄 原始集数更新逻辑修复：修复新剧集追踪的original_episodes更新逻辑
- 🔁 重复播放记录问题：解决重复播放记录和错误original_episodes值的问题
- 🗄️ Upstash对象反序列化支持：修复日历缓存的Upstash对象反序列化问题
- 📝 自动更新检测original_episodes保留：防止auto-update检测时覆盖original_episodes字段
- 🔐 用户注册后Upstash主从同步等待：修复Upstash主从同步延迟问题
- 🚫 Next.js动态路由警告消除：为动态API路由添加force-dynamic声明，清理控制台警告

## [5.5.3] - 2025-09-30

### Added

- 🎯 用户等级系统：新增用户等级系统取代大数字登录次数显示，提供更友好的用户体验
- 📅 登录时间追踪：实现登录时间跟踪功能，增强管理员用户清理配置和分析能力

### Changed

- 🏷️ 用户等级显示逻辑：用户等级从首次登录时开始显示，避免0登录边界情况
- 📝 管理员页面文案：更新管理页面文本以反映基于登录的用户删除逻辑

### Fixed

- 🔄 播放记录原始集数修复：自动修复历史播放记录中缺失的original_episodes字段，消除数据警告
- 📺 继续观看卡片去重：修复重复的继续观看卡片问题，确保传递正确的数据源名称
- 🎮 用户等级系统边界处理：修复用户等级系统显示问题和0登录边界情况的处理逻辑
- 🛡️ TVBox IP白名单解析优化：修复x-forwarded-for头部解析问题，提升TVBox配置在代理环境下的访问准确性

## [5.5.2] - 2025-09-27

### Added

- ⚡ react-window升级至2.1.2版本：升级虚拟滚动库至最新版本，利用ResizeObserver优化提升性能
- 🎨 虚拟滚动开关界面美化：为虚拟滚动和聚合开关添加渐变样式、图标和动画效果，提升用户界面体验
- 🏠 首页继续观看新剧集徽章：为首页继续观看部分添加新剧集提醒徽章

### Changed

- 🎯 虚拟滚动网格尺寸优化：添加明确的高度和宽度设置，避免不必要的ResizeObserver调用，改善滚动体验
- 📊 overscanCount参数优化：将overscan数量从1调整为3（官方默认值），减少滚动时的视觉闪烁
- 🔔 继续观看组件主动更新检测：优化继续观看组件的主动更新检测机制
- 👤 用户菜单即时更新检测：修复用户菜单组件的即时更新检测逻辑
- 📅 TMDB排序优化：修复TMDB排序逻辑，使用正确的日期顺序（最新优先）
- 🎯 用户菜单实时更新增强：为用户菜单各组件添加全面的实时更新功能
- 🔍 继续观看进度过滤定制化：添加可定制的进度过滤器，移除95%上限限制

### Fixed

- 🔄 跨设备同步原始集数追踪：修复跨设备original_episodes同步问题，确保新剧集检测的准确性
- 📺 发布日历网格视图去重：为发布日历网格视图添加去重逻辑，避免重复条目显示
- 🐛 react-window 2.1.2加载和滚动问题：基于源码分析修复升级后的加载停滞和滚动异常问题
- 🖤 虚拟滚动黑色背景伪影：消除虚拟滚动过程中出现的黑色背景区域
- 📱 Grid滚动截断问题：修复Grid内滚动时最后一行被截断的显示问题，优化高度计算和边距设置
- 🔄 重复播放记录问题：修复更新剧集数量时产生重复播放记录的问题
- 📊 播放记录剧集数量同步：确保播放记录的剧集数量与新剧集检测保持同步

## [5.5.1] - 2025-09-25

### Fixed

- 🔧 Bangumi推荐接口错误处理增强：修复bangumi API返回null数据时导致首页崩溃的问题，使用Promise.allSettled防止单个API失败影响整个首页
- 🛡️ Bangumi数据结构类型安全修复：更新BangumiCalendarData接口定义，将所有可能缺失的字段标记为可选属性，确保类型安全
- 🖼️ Bangumi图片数据空值安全检查：添加可选链操作符处理anime.images可能为null的情况，提供默认占位图片作为fallback
- 🎯 首页推荐数据健壮性提升：为所有推荐API（电影、剧集、综艺、短剧、bangumi）添加错误处理和默认值，确保页面在部分API失败时仍能正常显示
- 🔄 继续观看功能更新提醒优化：从用户菜单更新提醒中移除继续观看功能，避免功能重复和用户困惑
- 📱 跨设备原始集数追踪机制：添加跨设备原始集数追踪功能，防止API缓存问题导致的错误更新提醒
- 🎪 观看更新检测逻辑完善：修复观看更新检测逻辑，确保更新通知的准确性和可靠性

## [5.5.0] - 2025-09-24

### Added

- 🎭 TMDB演员搜索系统：实现完整的演员搜索功能，支持过滤和缓存机制
- 📊 发布日历和即将上线系统：为用户提供即将发布的影视内容预览和跟踪功能
- 🔝 发布日历返回顶部按钮：为发布日历页面添加快捷返回顶部功能，提升浏览体验
- 🎯 非活跃用户自动清理功能：实现智能的非活跃账户自动清理机制，包含详细配置和日志记录
- 🔔 用户菜单更新提醒功能：新增更新提醒按钮，支持实时通知剧集更新和继续观看
- ▶️ 用户菜单继续观看功能：新增继续观看快捷入口，展示播放进度和待续看内容
- ❤️ 用户菜单我的收藏功能：新增收藏快捷入口，便捷访问收藏的影视内容
- 🔗 移除GitHub链接：清理登录和注册页面的GitHub相关链接，简化界面设计
- 📱 移动端弹幕配置优化：将外部弹幕默认设置为禁用状态，优化移动设备的弹幕配置和悬停稳定性
- 🎬 视频播放增强：升级HLS.js到v1.6.13版本，改进错误处理和播放稳定性

### Changed

- 🔄 管理员环境变量使用标准化：统一管理员相关的环境变量使用规范
- ⚙️ 音量控制悬停区域优化：减少音量控制的悬停触发区域，防止意外激活并优化检测精度
- 🎛️ 弹幕配置面板交互改进：通过延迟机制改进弹幕配置面板的悬停稳定性和精确控制
- 📅 发布日历视图数据显示改进：解决日历视图数据展示问题并增加地区信息显示
- 🎨 TMDB卡片界面简化：简化TMDB卡片设计并增强日历视图交互体验
- 🐛 TMDB虚拟滚动点击播放优化：修复虚拟滚动环境下的点击播放功能问题

### Fixed

- 🔧 TMDB缓存管理和搜索限制修复：解决TMDB缓存操作问题并移除搜索限制
- 📊 即将上线发布部分首次API失败修复：解决发布日历初次加载时的API调用失败问题
- 🎯 播放统计强制缓存清除修复：解决记录删除时的缓存清除问题，确保UI实时更新
- 📱 继续观看卡片实时更新修复：改进播放统计的数据刷新和实时更新机制
- 🔍 英语搜索匹配算法重构：使用基于词汇的算法改进英语搜索匹配准确性
- 🌐 语言感知搜索过滤实现：实现语言相关的搜索过滤以提高搜索结果相关性
- 🚫 搜索变体无意义词汇过滤：过滤搜索变体中的无意义词汇以防止不相关匹配
- 📺 播放页面搜索功能修复：移除数字变体并改进中文电影标题的模糊搜索
- ⚡ 搜索性能优化：移除早期退出策略，优化搜索相关性评分和同步播放页面逻辑
- 🎵 中文电影标题模糊搜索改进：改进带标点符号和数字变体的中文标题模糊搜索
- 🎯 智能模糊搜索相关性评分：实现带相关性评分的智能模糊搜索系统
- 🔢 数字后缀标题匹配优先级修复：修复搜索优先级以匹配带数字后缀的标题
- 🔄 观看更新检测逻辑优化：引入原始集数保护机制，防止API缓存问题导致的错误更新提醒
- 📈 观看更新算法完善：改进新集数检测和继续观看提醒的判断逻辑，确保更新通知准确性

## [5.4.4] - 2025-09-22

### Added

- 🎬 播放统计页面VideoCard观看更新显示系统：使用VideoCard组件显示观看更新，提供更直观的用户体验
- 📊 播放统计页面双重提醒系统：新增新剧集和继续观看独立分类，红色主题显示新剧集更新，蓝色主题显示继续观看提醒
- 🎨 播放统计页面视觉效果增强：为观看更新卡片添加红/蓝光环效果、渐变徽章和动画，提升界面美观度
- 📈 播放统计页面用户活动分析增强：新增登录天数计算，基于firstWatchDate逻辑补充现有注册天数数据
- 🛠️ 播放统计页面调试功能完善：为缓存读写操作添加详细日志记录，增强调试能力和故障排查
- 📋 管理员个人统计选项卡：为管理员统计页面添加选项卡切换功能，支持全局统计和个人统计视图
- 🆔 播放统计页面API端点安全性：新增/api/sources端点，安全地向客户端暴露可用数据源

### Changed

- 🔄 播放统计页面移除弹窗式更新：完全移除基于弹窗的观看更新显示方式，改用VideoCard直接展示
- 🔧 播放统计页面移除测试按钮：移除弹窗显示调试的测试按钮，简化界面
- 📋 播放统计页面WatchingUpdate接口扩展：为接口添加cover属性和continueWatchingCount字段，增强数据结构
- 🎯 播放统计页面更新检测逻辑优化：简化shouldShowUpdate条件，移除复杂的userWatchedLatest检查逻辑
- 🔧 播放统计页面参数修正：修复VideoCard的source/id参数使用正确的sourceKey和videoId值
- ⚡ 播放统计页面数据刷新机制优化：增强刷新数据按钮功能，支持清除缓存并强制重新检查更新
- 📊 播放统计页面统计计算标准化：统一管理员和个人统计页面的注册天数计算逻辑，使用PROJECT_START_DATE作为fallback
- 🌐 播放统计页面API源映射策略：从响应式改为主动式源名称到API密钥映射，预防API调用错误

### Fixed

- 🔢 修复播放统计页面继续观看计数错误：纠正继续观看数量计算逻辑，显示正确的统计值
- 📅 修复播放统计页面注册天数计算不一致：解决管理员统计显示7天而个人统计显示1天的差异问题
- ⚙️ 修复播放统计页面新用户创建时间戳：为自注册和管理员创建的新用户正确设置createdAt字段
- 🌐 修复播放统计页面API源映射问题：实现主动源名称到API密钥映射，避免400错误并修复Upstash环境变量错误
- 🔗 修复播放统计页面数据源映射逻辑：改进源名称与API配置的智能匹配，处理显示名称与内部API密钥差异
- 🚫 修复播放统计页面ESLint合规性：移除空箭头函数以符合ESLint规范要求
- 🏠 修复播放统计页面owner用户统计API：确保个人统计API使用实际用户createdAt而非当前时间
- 🔄 修复播放统计页面更新检测逻辑：确保只要latestEpisodes > record.total_episodes即显示更新，支持多剧集更新检测

## [5.4.3] - 2025-09-20

### Added

- 🎯 扩展Bangumi ID支持范围：从仅支持6位数字扩展至支持3-6位数字，兼容更多Bangumi主题ID

### Changed

### Fixed

- 🔧 修复弹幕菜单长时间播放后悬停失效问题：恢复原生ArtPlayer悬停机制处理弹幕控制
- 🖱️ 解决pointer-events阻挡导致的悬停检测失败：添加周期性状态重置防止长期DOM污染
- 🎮 实现精确进度条冲突解决方案：确保悬停功能在普通和全屏模式下均正常工作
- ⚡ 升级react-window至v2.1.1：采用单行网格优化改善布局处理
- 🔄 确保单行网格高度约束：当rowCount === 1时利用react-window 2.1.1修复
- 📺 修复剧集切换播放时间不重置问题：添加剧集变更检测标志
- 🎯 区分剧集和源切换逻辑：剧集使用switchUrl()重置至0，源使用switchQuality()保持时间
- 🧹 完善标志清理机制：确保所有路径下的状态标志正确清理

## [5.4.2] - 2025-09-19

### Added

- 🎯 网盘搜索结果标题展开收起功能增强：支持移动端30字符、桌面端80字符响应式展开
- 📱 网盘搜索结果移动端显示优化：长标题自动截断并提供展开按钮功能

### Changed

- 🎨 网盘搜索结果标题按钮样式升级：采用蓝色胶囊按钮设计，支持悬停效果和旋转动画图标
- 📱 移动端视频控制器断点优化：从768px调整至1024px，更好支持现代手机屏幕
- 🔄 移动端控制器跨方向响应性改进：移除方向限制，在所有方向下都应用移动端优化
- ⚡ 弹幕性能优化：源切换时的批量处理和去重优化

### Fixed

- 🔧 修复弹幕清理序列防止重复：正确使用弹幕插件清理流程
- 🎮 修复ArtPlayer弹幕插件API调用：移除无效调用并使用正确的API方法
- 🎵 解决视频源切换时弹幕重复和延迟：添加源切换标志位防止重复加载，优化状态管理
- 📺 修复首集切换时弹幕不更新：重置弹幕加载状态，清理旧数据防止竞态条件
- 📱 简化视频控制器媒体查询防止按钮溢出：移除悬停和指针限制，确保一致的UI行为
- 🖥️ 修复桌面浏览器窗口缩小时的控制按钮溢出问题：在1024px以下隐藏特定控件

## [5.4.1] - 2025-09-17

### Added

- 🚀 弹幕性能激进优化：智能分段加载系统，按5分钟分段管理弹幕数据
- 🎯 设备性能自动检测：根据硬件性能自动调整弹幕渲染策略
- 💡 动态弹幕密度控制：实时监控屏幕弹幕数量，自动丢弃过量弹幕保持流畅
- 🔧 用户组权限系统：为AI助手和YouTube功能添加用户组权限控制

### Changed

- 🎮 TVBox配置移动：从导航栏移至用户菜单，优化界面布局
- ⚡ 弹幕数量限制移除：取消10000条硬编码限制，支持处理大量弹幕数据
- 🎯 弹幕过滤策略升级：更严格的质量过滤，智能采样保持时间分布均匀
- 🔄 短剧缓存系统增强：自动清理机制和HTTP缓存优化

### Fixed

- 🐛 TVBox API路由兼容性：修复动态分类获取和配置字段兼容问题
- 📱 短剧移动端缓存：解决缓存刷新问题，提升移动端体验
- 🎬 YouTube流量说明：修复管理面板中的流量解释显示
- 🎛️ 播放统计导航：修复activePath属性，确保导航高亮正确
- ⚡ 进度跳转卡顿：通过硬件加速和批量处理大幅改善拖拽性能
- 🔄 集数切换优化：防抖处理和状态管理，减少切换时的延迟

## [5.4.0] - 2025-09-14

### Added

- 🎬 短剧完整功能集成：全面集成短剧搜索、播放、详情展示功能
- 📱 短剧移动端API代理路由：为移动端提供专用的短剧API代理，解决跨域问题
- 💾 短剧缓存系统：集成短剧缓存到管理员系统，提供完整的缓存管理功能
- 🎯 短剧专用详情页面布局：避免与豆瓣详情冲突，提供专门的短剧展示界面
- 📊 播放统计系统：完整的播放数据统计和分析功能
- 🎮 弹幕面板移动端优化：基于ArtPlayer挂载逻辑的精确定位

### Changed

- 🔄 短剧内容过滤优化：防止短剧显示豆瓣/Bangumi数据，确保数据源纯净
- 📐 移动端弹幕面板定位逻辑：改进CSS定位算法，提升移动端体验
- 🎵 移动端弹幕面板操作：简化为点击切换机制，避免复杂手势冲突
- 🔍 内容筛选功能优化：移除所有内容类型（电影、剧集、综艺、动漫）的快捷筛选功能，避免与普通筛选冲突
- 🎛️ 侧边栏高亮修复：改进导航状态同步机制

### Fixed

- 🔧 短剧API路由缓存问题：添加HTTP缓存控制头，解决移动端缓存不刷新问题
- 📱 移动端API代理循环依赖：解决短剧功能的循环依赖问题
- 🎯 短剧详情显示优化：防止显示0集数，添加双重保护机制
- ⭐ 短剧评分显示：隐藏零评分内容，优化用户体验
- 🎮 播放统计Redis错误：修复KVRocks JSON解析错误
- 📐 移动端弹幕面板定位：修复音量控制悬停状态的定位问题
- 🔊 音量控制交互优化：修复移动端音量按钮hover状态异常问题
- 🔄 视频播放器问题：修复动漫筛选和视频播放相关bug

---

## [5.3.2] - 2025-09-13

### Added

- 🎯 弹幕设置菜单交互优化：添加桌面端hover延迟交互机制（300ms显示，500ms隐藏）
- ⚡ 弹幕菜单性能大幅优化：实现防抖机制，解决开启弹幕时调节字幕大小卡顿问题
- 🔄 事件监听器全面优化：为位置调整、方向变化、DOM观察器添加防抖处理，提升整体性能
- 🎮 AI推荐系统令牌优化：默认最大令牌数从1000提升至3000，改善AI响应质量

### Changed

- 🛠️ 基于ArtPlayer原生拖拽逻辑实现精确弹幕菜单修复
- 🔍 DOM观察器优化：减少监听范围，仅观察必要的class变化
- ⏱️ 增强定时器清理机制：防止内存泄漏，确保所有定时器正确释放
- 📐 弹幕面板位置算法重构：使用CSS默认定位替代复杂的手动计算

### Fixed

- 🔧 修复弹幕配置菜单全屏模式定位问题：改进CSS定位算法，确保各种屏幕模式下正确显示
- 🖱️ 解决进度条拖拽与弹幕菜单冲突：基于ArtPlayer原生拖拽逻辑实现精确修复
- 📱 修复移动端弹幕菜单定位算法：纠正位置计算逻辑，适配不同设备屏幕
- 🎯 弹幕面板点击事件冲击修复：解决弹幕面板阻挡进度条点击的核心问题
- 🧹 AI聊天历史自动清理机制修复：优化历史记录管理和清理逻辑
- 🔄 移除播放器设置中的重复弹幕切换选项：简化用户界面
- 💡 弹幕菜单CSS hover冲突解决：精确控制hover状态与进度条拖拽的交互
- 📋 完善弹幕菜单hover行为：统一移动端和桌面端交互逻辑，提供一致用户体验

---

## [5.3.1] - 2025-09-11

### Added

- 🎥 AI推荐系统YouTube视频链接解析：支持直接解析YouTube视频链接并获取视频信息
- 🔍 AI推荐卡片三种类型支持：影视推荐卡片、YouTube视频卡片、视频链接解析卡片

### Enhanced

- 🚀 升级react-window到v2.1.0：性能优化提升虚拟滚动效率
- 📺 升级hls.js到v1.6.12：改进视频播放稳定性和兼容性
- 🎬 YouTube搜索功能增强：支持时间筛选和排序选项
- 🔄 直播源自动刷新功能：支持localStorage持久化配置
- 🎯 电影快速筛选按钮：新增类型快速访问功能
- 📱 TV节目和综艺节目筛选扩展：完善筛选功能覆盖
- 🎮 YouTube直播播放器优化：实时视频信息获取功能

### Fixed

- 🔧 修复AI聊天列表项空格过多问题：优化markdown格式处理逻辑
- 📝 解决AI响应中项目符号间距过大问题：移除多余的margin-bottom样式
- 🎵 修复外部弹幕拖拽进度条后显示异常问题：改进弹幕同步机制
- 🔍 修复YouTube搜索缓存键和内容类型筛选问题：优化缓存管理策略
- 📺 修复TV节目和综艺节目MultiLevelSelector缺失initialValues属性问题
- 🛠️ 解决DoubanSelector中的TypeScript编译错误
- 🎯 修复平台筛选状态同步问题：改进TV节目筛选器状态管理
- 🔗 使用YouTube无cookie域名：减少机器人验证问题
- 📊 修复搜索历史显示问题：优化历史记录展示逻辑
- 🔝 修复播放页面返回顶部按钮显示问题

---

## [5.3.0] - 2025-09-10

### Added

- 🎥 YouTube集成: 完整的YouTube搜索和直播播放功能
  - 集成YouTube Data API v3搜索功能
  - 支持iframe直接播放YouTube视频
  - 管理后台YouTube API配置面板
  - YouTube缓存管理系统（参考网盘实现）
  - YouTube搜索结果缓存统计和管理
- 🔧 AI推荐系统: 增强的AI内容推荐功能
  - 动态提示词和模型管理优化
  - 支持GPT-5/o系列模型的max_completion_tokens
  - 改进推荐UI和卡片显示计数器
  - 优化推理模型空响应处理
- 📱 TVBox安全配置: 全面的TVBox集成
  - 通过管理后台完整配置TVBox安全设置
  - API优化和安全性增强
  - 配置面板移动端UI优化
- 🎬 iPad/iOS视频播放优化: 全面的移动端播放改进
  - 基于ArtPlayer兼容性模式的智能设备检测
  - iOS特定自动播放策略（静音启动+音量恢复）
  - 基于官方源码优化的HLS.js配置
  - 多重尝试自动播放重试机制，提升成功率
  - 移动设备内存管理优化

### Changed

- 🚀 搜索性能: 智能搜索优化和状态管理
  - 切换搜索类型时清除网盘搜索状态
  - 功能切换时的缓存绕过改进
  - 防止功能禁用时的无限重试循环
- 🎯 移动端UI: 响应式设计改进
  - TVBox配置移动端显示优化（token复制/重新生成按钮）
  - 配置面板移动端布局改进
- 💾 缓存管理: 统一缓存系统增强
  - 管理员端点缺失的配置缓存清理
  - YouTube集成到完整缓存管理基础设施
  - 所有搜索类型的数据库缓存统计（YouTube、网盘、豆瓣、弹幕）
- 🏗️ HLS.js优化: 基于官方源码的移动设备流媒体改进
  - 缓冲策略：iOS13+ 8秒，iOS 10秒，桌面30秒
  - 内存管理：iOS13+ 20MB，iOS 30MB缓冲大小
  - 加载策略：移动端优化的超时和重试策略
  - ABR优化：移动设备更快的码率切换
- 🔧 代码质量: 增强的TypeScript支持和错误处理
  - EventListener API兼容性改进
  - 复杂函数中的变量作用域管理优化
  - 改进错误边界和回退机制
- 📦 架构: 遵循现有模式的模块化YouTube集成
  - 与其他搜索功能一致的API端点结构
  - 跨所有搜索类型的统一缓存管理
  - 遵循既定模式的配置管理

### Fixed

- 🔄 修复功能禁用时网盘搜索卡死问题
- 🛠️ 解决功能禁用场景下的无限重试循环
- 🔧 修复TVBox安全配置移动端UI截断问题
- 📱 修正AI推荐卡片显示并防止无效链接点击
- 🎵 修复GPT-5/推理模型因token限制导致的空响应
- 🔨 解决EventListenerOptions的TypeScript编译错误
- 📊 修复管理面板中YouTube缓存统计显示问题
- 🎭 改进配置缓存管理的错误处理

---

## [5.2.1] - 2025-09-08

### Fixed

- 🔧 修复 ArtPlayer 5.3.0 SSR 兼容性问题：通过动态导入解决服务端渲染时的 window 对象访问错误
- 📱 修复直播页面 ArtPlayer SSR 问题：实现相同的动态导入策略，避免 Cannot read properties of undefined 错误  
- 🛠️ 修复 TypeScript 编译错误：为 onSwitch 函数参数添加正确的类型注解
- 🔍 修复 searchFromApi 函数作用域问题：解决 apiBaseUrl 变量访问范围导致的编译错误
- 💾 修复 Docker 构建缓存问题：添加无缓存标志和依赖验证，确保新版本依赖正确应用
- 🎬 修复 ArtPlayer 5.3.0 销毁序列错误：优化播放器实例清理流程，防止运行时错误
- 🚫 移除不必要的视频元素存在性检查：简化销毁流程，提高稳定性

### Enhanced

- 🎯 实现智能搜索优化：新增搜索查询变体生成器，自动尝试多种搜索模式提高命中率
- 🔄 优化豆瓣/bangumi 点击搜索：解决手动搜索能找到但点击找不到的标题空格匹配问题
- ⚡ 智能搜索变体支持：自动生成去空格、关键词组合等搜索变体，支持中餐厅 第九季→中餐厅第九季等转换
- 🎬 播放页面搜索增强：在播放页面集成智能搜索变体，提升豆瓣内容的片源搜索成功率
- 💬 弹幕插件 v5.2.0 优化：
  - 启用 useWorker: true 实现基于 Web Worker 的弹幕位置计算
  - 减少 lockTime: 2 降低拖拽延迟，提升交互响应性
  - 实现基于设备性能的智能配置：
    - 高性能设备：启用完整功能，包含防重叠算法 + Worker
    - 中等性能设备：选择性防重叠 + Worker
    - 低性能设备：禁用防重叠但保持同步 + Worker，减少 maxLength 至 30
  - 保持 synchronousPlayback: true 确保所有设备的一致用户体验
  - 优化拖拽/窗口变化事件处理，改进防抖机制

### Technical Improvements  

- 🏗️ ArtPlayer 动态导入架构：重构播放器初始化流程，支持客户端只加载，完全兼容 Next.js SSR
- 🔨 代码质量优化：修复 ESLint 导入排序警告，优化变量声明规范
- 📦 依赖版本同步：确保 package.json 和 pnpm-lock.yaml 版本一致性
- 🏗️ 改进 Docker 构建流程：优化缓存策略，确保依赖更新的可靠性
- 🔄 播放器实例管理优化：改进多实例冲突处理和 DOM 清理逻辑

---

## [5.2.0] - 2025-09-07

### Added

- 🎬 升级播放器核心：将 Artplayer 从 5.2.5 升级到 5.3.0，提升播放稳定性和性能
- 💬 升级弹幕插件：将 artplayer-plugin-danmuku 从 5.1.8 升级到 5.2.0，优化弹幕显示效果
- 📱 移动端底部导航增强：TVBox 设置集成到移动端底部导航，提升移动端管理便利性
- 🔍 PanSou 网盘搜索集成：集成高级筛选和用户体验优化的网盘搜索功能
- 🗂️ 网盘搜索优化：优化搜索算法和缓存管理，提升搜索响应速度和准确性
- 🎥 视频详情页网盘搜索：在播放/详情页面直接集成网盘搜索功能，一站式观影体验
- 🔄 Upstash Redis 缓存集成：完整集成 Upstash Redis 缓存系统，提升数据访问性能
- ⚡ KVRocks 缓存兼容：新增 KVRocks 存储类型特定处理，完善缓存兼容性支持

### Fixed

- 🔧 修复 TVBox 配置生成错误：解决 undefined API 导致的配置生成失败问题
- 💾 修复存储类型处理：完善 Upstash 和 KVRocks 缓存兼容性处理逻辑

---

## [5.1.0] - 2025-09-05

### Added

- 🚀 新增豆瓣弹幕API反IP封锁优化：智能延迟策略防止频繁请求被封
- 🔍 新增IPTV频道当前源内搜索功能：支持在当前直播源中快速搜索频道
- 📱 新增豆瓣页面虚拟滚动支持：提升大量内容加载性能和用户体验
- 🎵 新增EXT-X-MEDIA URI处理：防止HLS音轨加载错误导致播放失败
- 🎌 新增Bangumi API集成：实现动漫内容智能检测和信息获取
- 💾 新增Bangumi API缓存机制：提升动漫信息获取速度，减少重复请求
- 🏪 迁移到统一存储缓存：设置直连代理为默认选项，优化网络性能
- 📦 新增TVBox完整API兼容支持：实现完整的TVBox功能接口
- 📺 实现直播源聚合功能：解决多源限制问题，提升直播体验
- 🔧 更新视频解析器接口：新增健康检查机制，提升解析稳定性

### Changed

- ⚡ 优化豆瓣API请求智能延迟策略：根据请求频率动态调整延迟时间
- 🛡️ 改进HLS错误处理：防止keyLoadError导致页面冻结，提升播放稳定性
- ⚙️ 默认禁用源优化和速度测试：减少不必要的网络请求，提升启动速度
- 🚫 禁用TVBox API缓存：排除中间件认证，优化TVBox兼容性

### Fixed

- 🔗 修复聚合搜索结果传递douban_id参数到播放页面的问题
- 📱 修复移动端操作面板在虚拟滚动模式下的截断问题

---

## [5.0.0] - 2025-08-30

### Added

- 🌟 全新豆瓣详情增强显示：播放页面新增丰富的豆瓣电影/剧集信息展示
- ⭐ 豆瓣评分显示：带星级图标的直观评分展示
- 🎭 完整演职人员信息：导演、编剧、主演等详细信息
- 📅 首播/上映日期：智能区分电影和剧集显示格式
- ⏱️ 时长信息：支持电影总片长和剧集单集时长显示
- 🌍 制作信息：国家/地区、语言、集数等标签展示

### Enhanced

- 🔧 豆瓣API解析引擎完全重构：基于真实HTML结构精确解析
- 📺 剧集支持：完美解析中国电视剧信息（如《生万物》）
- 🎥 电影支持：准确提取国际电影数据（如《坏蛋联盟2》）
- 🎨 动漫支持：全面兼容日本动画作品（如《怪兽8号》）
- 👥 多演员处理：正确解析多导演、多编剧、大型演员阵容
- 🌐 多语言适配：支持中文、英文、日文等不同语言内容

### Fixed

- 🐛 修复豆瓣详情API解析失败问题：重新设计HTML结构匹配算法
- 🔄 解决首播日期重复显示问题：优化日期提取逻辑，避免'首播:首播:'格式错误
- ✨ 修复演职人员信息缺失：使用精确的CSS选择器匹配豆瓣页面真实结构
- 🎯 优化豆瓣评分显示：新增星级图标和颜色区分，提升视觉体验

### Breaking Changes

- 🚨 主版本升级至5.0.0：豆瓣详情系统重大改进，API响应格式优化
- 📊 豆瓣详情数据结构调整：新增多个字段，删除重复内容显示

---

## [4.3.7] - 2025-08-30

### Added

- 🚀 高性能弹幕系统优化：实现基于设备性能的智能弹幕渲染策略，自动检测CPU核心数、内存容量和设备类型
- 🎯 设备性能分级渲染：高性能设备启用完整功能，中等性能设备适度优化，低性能设备激进优化，确保流畅播放
- 💻 Web端专用弹幕输入按钮：新增简洁的弹字按钮，支持一键快速发送弹幕，仅在Web浏览器显示，避免移动端UI拥挤
- ⚡ CSS硬件加速优化：为低性能设备启用GPU硬件加速，使用transform和will-change属性优化弹幕动画性能

### Improved

- 🧠 智能弹幕过滤器：保持完整弹幕数量的同时，只过滤可能影响性能的超长弹幕和特殊字符弹幕
- 🎨 自适应弹幕配置：根据设备性能自动调整防重叠算法、同步播放等计算密集型功能的启用策略

### Changed

- 🎛️ 弹幕渲染策略重构：从减少弹幕数量改为优化渲染性能，确保用户体验不受影响
- 🖥️ 响应式UI设计：弹幕输入功能仅在Web端启用，移动端专注于播放体验，避免UI元素冲突
- ⚙️ 设备检测算法：基于硬件并发数、内存限制和设备类型计算综合性能评分，实现精准的性能分级

### Technical

- 🛠️ TypeScript类型安全：修复弹幕插件类型定义兼容性问题，使用const assertion确保类型正确性
- 🔧 代码架构优化：重构弹幕性能检测逻辑，采用工厂模式根据设备性能生成最优配置
- 📊 性能监控增强：添加详细的性能等级日志输出，便于调试和性能分析

---

## [4.3.6] - 2025-08-30

### Added

- 🚀 新增虚拟滑动功能：搜索结果支持虚拟化渲染，显著提升大量结果的加载性能
- 📱 智能响应式网格：根据屏幕尺寸自动调整列数（2-8列），完美适配手机到桌面端
- ⚡ 渐进式加载：搜索结果分批加载（初始12项，滚动时自动加载更多），优化首屏体验
- 🎛️ 虚拟滑动开关：用户可在搜索页面自由切换虚拟滑动和传统网格显示模式
- 🔧 智能容器尺寸检测：采用ResizeObserver监听容器变化，确保布局始终准确

### Changed

- 🎨 优化搜索结果渲染性能：使用react-window 2.0.0进行DOM节点虚拟化，减少内存占用
- 📐 改进响应式布局算法：基于实际容器宽度动态计算最优列数和项目尺寸
- 🔄 升级加载状态显示：新增容器尺寸初始化进度提示，提升用户体验

### Fixed

- 🐛 修复首次搜索时虚拟滑动布局偏移问题：解决容器尺寸计算时序导致的初始布局错误
- ⏱️ 修复容器引用挂载时机问题：优化useLayoutEffect执行顺序，确保DOM元素正确绑定
- 🔧 修复react-window 2.0.0 API兼容性：适配新版本的cellComponent和cellProps参数结构

## [4.3.5] - 2025-08-29

### Added

- 新增Chromecast投屏功能：支持将视频内容投射到Chromecast设备
- Chromecast智能浏览器检测：仅在真正的Chrome浏览器中显示Chromecast按钮
- 排除厂商浏览器显示Chromecast：自动识别并排除OPPO、小米、华为、三星等厂商浏览器

### Changed

- 优化弹幕控制按钮显示策略：只显示配置按钮，隐藏切换按钮和发射器以节省空间

### Fixed

- 修复小屏幕设备控制栏按钮被推出画面的问题：优化弹幕插件控制按钮占用空间
- 修复移动端弹幕配置按钮不显示的问题：调整width参数确保移动端正确显示
- 修复OPPO等厂商浏览器错误显示Chromecast按钮的问题：增加OppoBrowser和HeyTapBrowser识别

## [4.3.4] - 2025-08-28

### Added

- 新增弹幕数据智能缓存机制：支持localStorage持久化存储，30分钟缓存有效期
- 缓存支持页面刷新保持：重新打开页面时自动复用缓存数据，避免重复请求
- 智能缓存键生成：基于影片标题、年份、豆瓣ID、集数生成唯一缓存标识
- 智能过期清理机制：每次缓存更新时自动清理过期数据，保持localStorage整洁

### Changed

- 优化切换集数时的弹幕加载逻辑：统一使用缓存优先策略，提升切换速度
- 改进弹幕API调用性能：相同集数重复访问时直接使用缓存，减少服务器压力
- 增强状态同步机制：弹幕缓存键使用最新state值而非ref值，确保数据一致性

### Fixed

- 修复切换集数时弹幕数据未清空的问题：现在使用正确的load()方法清空弹幕
- 修复页面刷新后缓存失效的问题：改用localStorage替代内存缓存
- 修复缓存键生成时机过早导致的缓存未命中问题
- 修复ESLint编译错误：规范变量声明和Map迭代语法

## [4.3.3] - 2025-08-28

### Fixed

- 修复外部弹幕开关按钮点击延迟和无响应问题，现在切换更加流畅
- 修复关闭外部弹幕后仍显示弹幕的问题，现在会完全清空弹幕数据
- 修复快速切换外部弹幕开关时的竞态条件问题，避免状态不一致
- 修复弹幕显示区域调整无效的问题，现在可以正确控制弹幕显示范围
- 恢复弹幕加载提示功能，现在会显示'已加载 X 条弹幕'或'暂无弹幕数据'

### Added

- 新增弹幕字号动态调整：支持小号(18px)、默认(25px)、大号(32px)、特大(40px)四种规格
- 新增弹幕显示区域控制：支持1/4屏幕、1/2屏幕、3/4屏幕、全屏四种显示范围，避免遮挡重要画面
- 新增弹幕速度调节：支持极慢(10秒)到极快(1秒)五档速度，满足不同观看习惯
- 新增弹幕透明度设置：从完全透明(10%)到完全不透明(100%)五档透明度选择
- 新增按类型蒙蔽功能：支持选择性隐藏滚动、顶部、底部弹幕，用户可根据喜好过滤弹幕类型
- 新增弹幕防重叠开关：可开启/关闭弹幕重叠防护，优化密集弹幕显示效果
- 新增完善的弹幕配置错误处理机制，防止设置调整时播放器崩溃

### Improved

- 优化外部弹幕开关性能：使用Promise.resolve()替代setTimeout()实现更好的异步处理
- 改进弹幕显示区域配置：使用百分比值替代固定像素值，提升不同屏幕尺寸适配性
- 增强状态同步机制：防止React状态更新和ArtPlayer插件状态不一致导致的显示问题
- 所有弹幕设置均支持实时调整，无需刷新页面即可看到效果

## [4.3.2] - 2025-08-27

### Added

- 集成第三方弹幕API功能，支持从多个视频平台获取弹幕数据
- 新增caiji.cyou API集成，支持搜索真实视频内容而非预告片
- 支持腾讯视频、爱奇艺、优酷、B站等主流平台弹幕获取
- 智能内容匹配，自动过滤解说、预告等不相关内容
- 支持多平台弹幕数据合并和时间排序

### Fixed

- 修复弹幕API集数参数传递问题，现在切换集数时能正确获取对应集数的弹幕
- 改进集数匹配逻辑，支持多种URL格式
- 修复豆瓣链接解析只获取到预告片的问题
- 添加定时任务用户处理调试信息，便于排查删除用户仍出现的问题

### Changed

- 优化弹幕API超时机制，爱奇艺30秒、优酷25秒、其他平台20秒
- 改进弹幕数据格式转换，确保与ArtPlayer兼容
- 移除不合适的测试弹幕fallback逻辑

## [4.3.1] - 2025-08-27

### Added

- 新增用户自行注册功能
- 注册页面支持用户名、密码验证
- 管理员可配置是否允许用户注册
- 注册成功后自动登录

### Changed

- 登录页面在数据库模式下显示注册链接
- 增强用户名格式验证（3-20位字母数字下划线）
- 密码长度要求至少6位

## [4.3.0] - 2025-08-26

### Added

- 支持将 IPTV 频道添加到收藏中

### Changed

- 禁用 flv 直播，仅支持 m3u8 直播
- 降低代理 ts 分片的内存占用

## [4.2.1] - 2025-08-26

### Fixed

- 修复直播源加载失败或离开页面后依然无限加载的问题

## [4.2.0] - 2025-08-26

### Added

- 支持 flv 直播和直播地址解析到 mp4 的处理
- 增加直播台标的 proxy 以防止 cors
- 支持播放页选集分组的滚动翻页

### Changed

- 管理后台页面的按钮增加加载中的 UI

### Fixed

- /api/proxy/m3u8 仅对 m3u8 内容反序列化，降低内存和 CPU 消耗

## [4.1.1] - 2025-08-25

### Changed

- 增加对 url-tvg 和多 epg url 的支持

### Fixed

- 修复 epg 数据清洗中去重叠逻辑未考虑日期导致的问题

## [4.1.0] - 2025-08-24

### Added

- 解析 m3u 自带的 epg 和自定义 epg，增加今日节目单

### Changed

- 直播源数据刷新改为并发刷新

## [4.0.0] - 2025-08-24

### Added

- 增加 iptv 订阅和播放功能

### Changed

- 搜索页面视频卡片移动端/右键菜单添加豆瓣链接
- 搜索建议遵循色情过滤

## [3.2.1] - 2025-08-22

### Changed

- 新增色色过滤分类
- 调整搜索建议框层级

## [3.2.0] - 2025-08-22

### Added

- 视频源管理支持批量启用、禁用、删除
- 用户管理支持批量设置用户组
- 视频卡片右键/长按菜单新增新标签页播放

### Changed

- 视频卡片移动端 hover 时仅保留播放按钮
- 微调管理页面 UI 和视频卡片右键/长按菜单中的收藏样式

### Fixed

- 修复了搜索栏 enter 键自动选中第一个建议项的问题

## [3.1.2] - 2025-08-22

### Fixed

- 修复移动端卡片无法点击的问题

## [3.1.1] - 2025-08-21

### Fixed

- 修复了视频卡片 hover 的非播放按钮点击后进入播放页的问题

## [3.1.0] - 2025-08-21

### Added

- 增加用户组管理和用户组播放源限制
- 增加管理面板视频源有效性检查
- 搜索栏增加一键删除按钮

### Changed

- 放宽授权心跳对于网络问题的判断标准
- 统一管理面板弹窗使用 createPortal
- VideoCard 允许移动端响应 hover 事件
- 移动端布局 header 常驻，搜索按钮移动到 header 右侧
- 调大搜索接口超时时间

### Fixed

- 修复 bangumi 返回的整数评分无小数导致 UI 不对齐的问题

## [3.0.2] - 2025-08-20

### Changed

- 优化机器码生成逻辑

### Fixed

- 修复 redis url 不支持 rediss 协议的问题

## [3.0.1] - 2025-08-20

### Fixed

- 修复授权初始化错误

## [3.0.0] - 2025-08-20

### Added

- 防盗卖加固
- 支持自定义用户可用视频源

### Changed

- 右键视频卡片可弹出操作菜单

### Fixed

- 过滤掉集数为 0 的搜索结果

## [2.7.1] - 2025-08-17

### Fixed

- 修复 iOS 下版本面板可穿透滚动背景的问题

## [2.7.0] - 2025-08-17

### Added

- 视频卡片新增移动端操作面板，优化触控屏操作体验

### Changed

- 优化集数标题的匹配和展示逻辑

### Fixed

- 修复设置面板和修改密码面板背景可被拖动的问题

## [2.6.0] - 2025-08-17

### Added

- 新增搜索流式输出接口，并设置流式搜索为默认搜索接口，优化搜索体验
- 新增源站搜索结果内存缓存，粒度为源站+关键词+页数，缓存 10 分钟
- 新增豆瓣 CDN provided by @JohnsonRan

### Changed

- 搜索结果默认为无排序状态，不再默认按照年份排序
- 常规搜索接口无结果时，不再设置响应的缓存头
- 移除豆瓣数据源中的 cors-anywhere 方式

### Fixed

- 数据导出时导出站长密码，保证迁移到新账户时原站长用户可正常登录
- 聚合卡片优化移动端源信息展示

## [2.4.1] - 2025-08-15

### Fixed

- 对导入和 db 读取的配置文件做自检，防止 USERNAME 修改导致用户状态异常

## [2.4.0] - 2025-08-15

### Added

- 支持 kvrocks 存储（持久化 kv 存储）

### Fixed

- 修复搜索结果排序不稳定的问题
- 导入数据时同时更新内存缓存的管理员配置

## [2.3.0] - 2025-08-15

### Added

- 支持站长导入导出整站数据

### Changed

- 仅允许站长操作配置文件
- 微调搜索结果过滤面板的移动端样式

## [2.2.1] - 2025-08-14

### Fixed

- 修复了筛选 panel 打开时滚动页面 panel 不跟随的问题

## [2.2.0] - 2025-08-14

### Added

- 搜索结果支持按播放源、标题和年份筛选，支持按年份排序
- 搜索界面视频卡片展示年份信息，聚合卡片展示播放源

### Fixed

- 修复 /api/search/resources 返回空的问题
- 修复 upstash 实例无法编辑自定义分类的问题

## [2.1.0] - 2025-08-13

### Added

- 支持通过订阅获取配置文件

### Changed

- 微调部分文案和 UI
- 删除部分无用代码

## [2.0.1] - 2025-08-13

### Changed

- 版本检查和变更日志请求 Github

### Fixed

- 微调管理面板样式

## [2.0.0] - 2025-08-13

### Added

- 支持配置文件在线配置和编辑
- 搜索页搜索框实时联想
- 去除对 localstorage 模式的支持

### Changed

- 播放记录删除按钮改为垃圾桶图标以消除歧义

### Fixed

- 限制设置面板的最大长度，防止超出视口

## [1.1.1] - 2025-08-12

### Changed
- 修正 zwei 提供的 cors proxy 地址
- 移除废弃代码

### Fixed
- [运维] docker workflow release 日期使用东八区日期

## [1.1.0] - 2025-08-12

### Added
- 每日新番放送功能，展示每日新番放送的番剧

### Fixed
- 修复远程 CHANGELOG 无法提取变更内容的问题

## [1.0.5] - 2025-08-12

### Changed
- 实现基于 Git 标签的自动 Release 工作流

## [1.0.4] - 2025-08-11

### Added
- 优化版本管理工作流，实现单点修改

### Changed
- 版本号现在从 CHANGELOG 自动提取，无需手动维护 VERSION.txt

## [1.0.3] - 2025-08-11

### Changed

- 升级播放器 Artplayer 至版本 5.2.5

## [1.0.2] - 2025-08-11

### Changed

- 版本号比较机制恢复为数字比较，仅当最新版本大于本地版本时才认为有更新
- [运维] 自动替换 version.ts 中的版本号为 VERSION.txt 中的版本号

## [1.0.1] - 2025-08-11

### Fixed

- 修复版本检查功能，只要与最新版本号不一致即认为有更新

## [1.0.0] - 2025-08-10

### Added

- 基于 Semantic Versioning 的版本号机制
- 版本信息面板，展示本地变更日志和远程更新日志