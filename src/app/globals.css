@import 'tailwindcss';

/* ============================================
   Tailwind CSS 4.1 优化配置
   Next.js 16.1 + React 19 最佳实践
   ============================================ */

/* 定义 CSS Cascade Layers - 管理样式优先级 */
@layer reset, base, theme, components, utilities, overrides;

/* Dark Mode - 使用 class 选择器 */
@custom-variant dark (&:where(.dark, .dark *));

/* ============================================
   @property - 注册自定义属性支持动画
   ============================================ */
@property --gradient-angle {
  syntax: '<angle>';
  initial-value: 0deg;
  inherits: false;
}

@property --shimmer-position {
  syntax: '<percentage>';
  initial-value: -200%;
  inherits: false;
}

/* ============================================
   @theme - Tailwind 4 主题配置
   使用 OKLCH 色彩空间获得更好的颜色一致性
   ============================================ */
@theme {
  /* Font Family */
  --font-primary:
    'Inter', ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji',
    'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';

  /* Primary Colors - 使用 OKLCH 色彩空间 */
  --color-primary-50: oklch(0.985 0.015 220);
  --color-primary-100: oklch(0.95 0.03 220);
  --color-primary-200: oklch(0.9 0.06 220);
  --color-primary-300: oklch(0.8 0.12 220);
  --color-primary-400: oklch(0.7 0.18 220);
  --color-primary-500: oklch(0.6 0.2 220);
  --color-primary-600: oklch(0.5 0.18 220);
  --color-primary-700: oklch(0.4 0.15 220);
  --color-primary-800: oklch(0.3 0.12 220);
  --color-primary-900: oklch(0.2 0.1 220);
  --color-dark: #222222;

  /* Gray Colors - OKLCH 高对比度灰色 */
  --color-gray-50: oklch(0.985 0.002 247.858);
  --color-gray-100: oklch(0.962 0.003 247.896);
  --color-gray-200: oklch(0.922 0.005 255.508);
  --color-gray-300: oklch(0.866 0.011 253.077);
  --color-gray-400: oklch(0.705 0.015 256.802);
  --color-gray-500: oklch(0.553 0.016 257.417);
  --color-gray-600: oklch(0.434 0.018 256.788);
  --color-gray-700: oklch(0.344 0.022 257.287);
  --color-gray-800: oklch(0.267 0.027 257.281);
  --color-gray-900: oklch(0.207 0.042 264.364);
  --color-gray-950: oklch(0.118 0.041 264.695);
}

/* ============================================
   @layer reset - 基础重置
   ============================================ */
@layer reset {
  :root {
    --foreground-rgb: 255, 255, 255;
  }

  html,
  body {
    height: 100%;
    overflow-x: hidden;
    overscroll-behavior: none; /* 阻止 iOS Safari 拉动回弹 */
  }

  body {
    color: rgb(var(--foreground-rgb));
  }
}

/* ============================================
   @layer base - 全局基础样式
   ============================================ */
@layer base {
  /* 亮色模式渐变背景 */
  html:not(.dark) body {
    background: linear-gradient(
      180deg,
      #e6f3fb 0%,
      #eaf3f7 18%,
      #f7f7f3 38%,
      #e9ecef 60%,
      #dbe3ea 80%,
      #d3dde6 100%
    );
    background-attachment: fixed;
  }

  /* 自定义滚动条样式 */
  * {
    scrollbar-width: thin;
    scrollbar-color: rgb(107 114 128 / 0.3) rgb(31 41 55 / 0.1);
  }

  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: rgb(31 41 55 / 0.1);
  }

  ::-webkit-scrollbar-thumb {
    background: rgb(75 85 99 / 0.3);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgb(107 114 128 / 0.5);
  }

  /* 移动端隐藏滚动条 */
  @media (width < 768px) {
    html,
    body {
      scrollbar-width: none;
    }

    html::-webkit-scrollbar,
    body::-webkit-scrollbar {
      display: none;
    }
  }

  /* 隐藏所有滚动条（排除 ArtPlayer） */
  *:not(.artplayer):not(.artplayer *) {
    scrollbar-width: none;
  }

  *:not(.artplayer):not(.artplayer *)::-webkit-scrollbar {
    display: none;
  }
}

/* ============================================
   @layer components - 可复用组件样式
   ============================================ */
@layer components {
  /* 视频卡片悬停效果 */
  .video-card-hover {
    transition: transform 0.3s ease;
    will-change: transform; /* 提示浏览器优化 */
  }

  .video-card-hover:hover {
    transform: scale(1.05);
  }

  /* 渐变遮罩 */
  .gradient-overlay {
    background: linear-gradient(
      to bottom,
      rgb(0 0 0 / 0) 0%,
      rgb(0 0 0 / 0.8) 100%
    );
  }

  /* ArtPlayer 海报样式 */
  .art-poster {
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    background-color: #000;
  }

  /* 播放器视频样式 */
  div[data-media-provider] video {
    height: 100%;
    object-fit: contain;
  }
}

/* ============================================
   @layer utilities - 工具类
   ============================================ */
@layer utilities {
  /* 隐藏滚动条工具类 */
  .scrollbar-hide {
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* 动画工具类 */
  .animate-fadeIn {
    animation: fadeIn 0.2s ease-out;
  }

  .animate-scaleIn {
    animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .animate-fade-in {
    animation: fade-in 0.4s ease-out;
  }

  .smooth-transition {
    transition: all 0.3s ease-in-out;
  }

  /* 使用 @property 的渐变动画 */
  @keyframes card-shimmer {
    to {
      --shimmer-position: 200%;
    }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes scaleIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}

/* ============================================
   View Transitions API - React 19 优化
   使用 contain 和更短的动画时长
   ============================================ */
@keyframes slide-from-top {
  from {
    clip-path: polygon(0 0, 100% 0, 100% 0, 0 0);
  }
  to {
    clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
  }
}

@keyframes slide-from-bottom {
  from {
    clip-path: polygon(0 100%, 100% 100%, 100% 100%, 0 100%);
  }
  to {
    clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
  }
}

::view-transition-old(root),
::view-transition-new(root) {
  animation-duration: 0.4s; /* 从 0.8s 优化到 0.4s */
  animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  animation-fill-mode: both;
  contain: layout style paint; /* 隔离布局计算提升性能 */
}

::view-transition-old(root) {
  animation: none;
}

html.dark::view-transition-new(root) {
  animation-name: slide-from-top;
}

html:not(.dark)::view-transition-new(root) {
  animation-name: slide-from-bottom;
}

/* ============================================
   @layer overrides - 强制覆盖样式
   替代 !important，使用 layer 优先级
   ============================================ */
@layer overrides {
  /* 亮色模式文字颜色 - 修复 OKLCH 灰色过淡问题 */
  html:not(.dark) {
    --tw-text-opacity: 1;
  }

  html:not(.dark) .text-gray-900 { color: oklch(0.207 0.042 264.364); }
  html:not(.dark) .text-gray-800 { color: oklch(0.267 0.027 257.281); }
  html:not(.dark) .text-gray-700 { color: oklch(0.344 0.022 257.287); }
  html:not(.dark) .text-gray-600 { color: oklch(0.434 0.018 256.788); }
  html:not(.dark) .text-gray-500 { color: oklch(0.553 0.016 257.417); }

  html:not(.dark) .text-slate-900 { color: #0f172a; }
  html:not(.dark) .text-slate-800 { color: #1e293b; }
  html:not(.dark) .text-slate-700 { color: #334155; }
  html:not(.dark) .text-slate-600 { color: #475569; }
  html:not(.dark) .text-slate-500 { color: #64748b; }

  /* 背景颜色覆盖 */
  html:not(.dark) .bg-slate-50 { background-color: #f8fafc; }
  html:not(.dark) .bg-slate-100 { background-color: #f1f5f9; }
  html:not(.dark) .border-slate-200 { border-color: #e2e8f0; }
  html:not(.dark) .from-slate-50 { --tw-gradient-from: #f8fafc; }
  html:not(.dark) .to-slate-100 { --tw-gradient-to: #f1f5f9; }
  html:not(.dark) .hover\:bg-slate-100:hover { background-color: #f1f5f9; }
  html:not(.dark) .hover\:bg-slate-50:hover { background-color: #f8fafc; }
}

/* ============================================
   ArtPlayer 移动端优化
   使用容器查询和媒体查询结合
   ============================================ */
@media (width <= 768px) {
  .art-control-fullscreenWeb {
    display: none;
  }

  .art-control-volume {
    display: none;
  }

  /* 弹幕面板定位 - 控制栏中心 */
  .art-controls-center .artplayer-plugin-danmuku .apd-config-panel,
  .art-controls-center .artplayer-plugin-danmuku .apd-style-panel {
    position: absolute;
    inset-inline-start: 10%;
    transform: translateX(-50%);
    inset-inline-end: auto;
    max-inline-size: calc(100vi - 40px);
  }

  /* 弹幕面板定位 - 播放器容器 */
  .art-video-player .artplayer-plugin-danmuku .apd-config-panel,
  .art-video-player .artplayer-plugin-danmuku .apd-style-panel {
    position: absolute;
    inset-inline-start: 50%;
    transform: translateX(-50%);
    inset-inline-end: auto;
    max-inline-size: calc(100vi - 40px);
  }
}

/* 超小屏幕适配 */
@media (width <= 380px) {
  .art-controls button,
  .art-control {
    min-inline-size: 28px;
    padding-inline: 4px;
    font-size: 13px;
  }

  .art-controls {
    padding-inline: 4px;
  }

  .art-control-fullscreen {
    display: flex;
    min-inline-size: 32px;
  }

  .art-control-time {
    font-size: 11px;
    padding-inline: 2px;
  }

  .art-progress {
    block-size: 3px;
  }
}

/* 桌面端音量控制 hover 优化 */
@media (hover: hover) {
  .art-control-volume {
    position: relative;
    padding: 3px;
  }

  .art-control-volume::before {
    content: '';
    position: absolute;
    inset-block-start: -20px;
    inset-inline-start: -5px;
    inset-inline-end: -5px;
    inset-block-end: -3px;
    z-index: -1;
    pointer-events: auto;
  }

  .art-control-volume:hover .art-volume-panel,
  .art-volume-panel:hover {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    transition: opacity 0.15s ease 0.1s, transform 0.15s ease 0.1s;
  }

  .art-volume-panel {
    transition: opacity 0.15s ease 0.3s, transform 0.15s ease 0.3s;
  }
}

/* 移动端隐藏弹幕配置 */
@media (width <= 1080px), (hover: none) {
  .artplayer-plugin-danmuku .apd-config {
    display: none;
  }
}

/* 桌面端弹幕配置 hover */
@media (width >= 1081px) and (hover: hover) {
  .artplayer-plugin-danmuku .apd-config {
    position: relative;
    padding: 3px;
  }

  .artplayer-plugin-danmuku .apd-config:hover .apd-config-panel,
  .artplayer-plugin-danmuku .apd-config .apd-config-panel:hover {
    opacity: 1;
    pointer-events: auto;
    visibility: visible;
    transition: opacity 0.15s ease 0.1s;
  }

  .artplayer-plugin-danmuku .apd-config-panel {
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
    transition: opacity 0.15s ease 0.3s, visibility 0s ease 0.45s;
  }

  .artplayer-plugin-danmuku .apd-config-panel * {
    pointer-events: auto;
  }

  .artplayer[data-dragging="true"] .artplayer-plugin-danmuku .apd-config-panel {
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
    transition: none;
  }
}
